<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.559c7a0f11009ea869a6.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}img{border-style:none}button{font-family:inherit;font-size:100%;line-height:1.15;margin:0;overflow:visible;text-transform:none}[type=button],[type=reset],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[hidden]{display:none}h1,h2,p{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}ul{list-style:none;margin:0;padding:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Droid Sans,Helvetica Neue,Fira Sans,sans-serif;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid}img{border-style:solid}button{cursor:pointer}h1,h2{font-size:inherit;font-weight:inherit}a{text-decoration:inherit}a,button{color:inherit}button{padding:0;line-height:inherit}img,object,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}ul{list-style-type:disc;padding-left:1rem}body{background:#22292f;color:#f0edee;font-weight:300;margin:0;line-height:1.5;letter-spacing:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Droid Sans,Helvetica Neue,Fira Sans,sans-serif}h1,h2{margin-top:2rem;margin-bottom:1rem;color:#ed6a5a}h1{font-size:1.875rem}h2{font-size:1.5rem}h1:before,h2:before{color:#f6bbb4;margin-right:1rem}h1:before{content:"#";margin-left:-2.25rem}h2:before{content:"##"}p{margin-top:1rem;margin-bottom:1rem}article a{text-decoration:none}article a,article a:focus,article a:visited{color:#f6bbb4}article a:hover{color:#f6bbb4;border-bottom-width:1px;border-color:#31708e;text-decoration:none}nav a{color:#ed6a5a}nav a:focus,nav a:visited{color:#f0edee}nav a:hover{text-decoration:none;border-width:0}.post-header{font-size:1.875rem;font-weight:600}.post-header a{color:#ed6a5a;text-decoration:none}.frontmatter{color:#dae1e7;font-size:.75rem}.frontmatter a{color:#f6bbb4;text-decoration:none}.button{padding:.5rem 1rem;border-radius:.25rem}.bg-red{background-color:#ed6a5a}.bg-teal{background-color:#31708e}.bg-blue-dark{background-color:#324a69}.bg-purple-darker{background-color:#bc9cc2}.hover\:bg-blue-darker:hover{background-color:#1c293b}.border-teal-light{border-color:#568aa2}.hover\:border-white:hover{border-color:#f0edee}.hover\:border-blue-darker:hover{border-color:#1c293b}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.border-2{border-width:2px}.border{border-width:1px}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.hidden{display:none}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.font-medium{font-weight:500}.font-black{font-weight:900}.h-3{height:.75rem}.h-6{height:1.5rem}.h-7{height:1.75rem}.leading-normal{line-height:1.5}.m-auto{margin:auto}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.mb-0{margin-bottom:0}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.ml-2{margin-left:.5rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-8{margin-bottom:2rem}.max-w-lg{max-width:50rem}.p-2{padding:.5rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.shadow{box-shadow:0 2px 4px 0 rgba(0,0,0,.1)}.shadow-md{box-shadow:0 4px 8px 0 rgba(0,0,0,.12),0 2px 4px 0 rgba(0,0,0,.08)}.fill-current{fill:currentColor}.text-gray-light{color:#afadae}.hover\:text-white:hover,.text-white{color:#f0edee}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.hover\:no-underline:hover,.no-underline{text-decoration:none}.align-middle{vertical-align:middle}.w-3{width:.75rem}.w-6{width:1.5rem}.w-16{width:4rem}.w-full{width:100%}@media (min-width:576px){.sm\:text-4xl{font-size:2.25rem}}@media (min-width:992px){.lg\:inline-block{display:inline-block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:items-center{align-items:center}.lg\:h-32{height:8rem}.lg\:mt-0{margin-top:0}.lg\:text-5xl{font-size:3rem}.lg\:w-32{width:8rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.20.9"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9152758-1', 'auto', {});
      
      
      
      
      
      }</script><link rel="alternate" type="application/rss+xml" title="David Bernheisel&#x27;s Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="36x36" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="48x48" href="/android-chrome-48x48.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="72x72" href="/android-chrome-72x72.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="96x96" href="/android-chrome-96x96.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="144x144" href="/android-chrome-144x144.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png?v=611230f76b9c00b58e5b99e8a179a99d"/><title data-react-helmet="true">VIM Testing and Workflow | David Bernheisel</title><meta data-react-helmet="true" name="description" content="I realized that I love my VIM workflow, so I want to share that with you.
I am by-no-means a VIM expert or purist â€” my neovim files are notâ€¦"/><link as="script" rel="preload" href="/styles-48fa8a050a65bb8447bd.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-2780d9b33f550a804e84.js"/><link as="script" rel="preload" href="/1777bc0a756dace6068a54d243c7071eee1627a0-2735f80a26e928b0d3f0.js"/><link as="script" rel="preload" href="/framework-1cbcc4f69858806ac5db.js"/><link as="script" rel="preload" href="/app-e49f8733b8aee9471acf.js"/><link as="script" rel="preload" href="/webpack-runtime-591c32b048d2d82d0b81.js"/><link as="fetch" rel="preload" href="/page-data/blog/vim-workflow/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="shadow-md flex items-center justify-between flex-wrap bg-teal p-4"><a class="text-white no-underline" href="/"><div class="flex items-center flex-shrink-0 text-white mr-6"><img src="/static/profile-picture-977b63cbce04bae4479e3185b22bfb1a.jpg" alt="David Bernheisel" class="w-16 h-16 lg:w-32 lg:h-32 rounded-full shadow-md border-2 border-teal-light mr-4"/><span class="text-2xl sm:text-4xl lg:text-5xl font-black">David Bernheisel</span></div></a><div class="block lg:hidden"><button class="flex items-center px-3 py-2 border rounded text-gray-light border-teal-light hover:text-white hover:border-white"><svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div class="w-full block lg:mt-0 mt-4 lg:flex lg:items-center lg:w-auto hidden"><a class="text-white no-underline bg-blue-dark hover:border-blue-darker hover:bg-blue-darker text-white font-medium block lg:inline-block mt-4 mr-4 lg:mt-0 shadow rounded py-1 px-3" href="/">Blog</a><a class="text-white no-underline bg-blue-dark hover:border-blue-darker hover:bg-blue-darker text-white font-medium block lg:inline-block mt-4 mr-4 lg:mt-0 shadow rounded py-1 px-3" href="/projects/">Projects</a><a class="bg-blue-dark hover:border-blue-darker hover:bg-blue-darker text-white font-medium block lg:inline-block mt-4 mr-4 lg:mt-0 no-underline hover:no-underline shadow rounded py-1 px-3" href="https://twitter.com/bernheisel">Twitter</a><div class="lg:mt-0 mt-4 py-1"><a href="/rss.xml"><img class="h-7 align-middle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgaWQ9IlJTU2ljb24iCiAgICAgdmlld0JveD0iMCAwIDggOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiPgoKICA8dGl0bGU+UlNTIGZlZWQgaWNvbjwvdGl0bGU+CgogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuYnV0dG9uIHtzdHJva2U6IG5vbmU7IGZpbGw6IG9yYW5nZTt9CiAgICAuc3ltYm9sIHtzdHJva2U6IG5vbmU7IGZpbGw6IHdoaXRlO30KICA8L3N0eWxlPgoKICA8cmVjdCAgIGNsYXNzPSJidXR0b24iIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIxLjUiIC8+CiAgPGNpcmNsZSBjbGFzcz0ic3ltYm9sIiBjeD0iMiIgY3k9IjYiIHI9IjEiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsNCBhIDMsMyAwIDAgMSAzLDMgaCAxIGEgNCw0IDAgMCAwIC00LC00IHoiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsMiBhIDUsNSAwIDAgMSA1LDUgaCAxIGEgNiw2IDAgMCAwIC02LC02IHoiIC8+Cgo8L3N2Zz4=" alt="RSS"/></a></div></div></nav><main class="p-4 m-auto max-w-lg"><article class="blog-post"><h1 class="mb-0 text-3xl">VIM Testing and Workflow</h1><p class="mt-0 mb-8 text-sm frontmatter"><span>Published on <!-- -->August 28, 2019</span><span><span class="mx-2">|</span>6<!-- -->m read</span></p><div><p>I realized that I love my VIM workflow, so I want to share that with you.
I am by-no-means a VIM expert or purist â€” my <a href="https://neovim.io">neovim</a> files are not slim and
are a melting pot of stolen code from others, sometimes modified or not,
sometimes found in GitHub comments, sometimes found in othersâ€™ dotfiles, or
Reddit comments.</p>
<p>If you develop in Ruby or Elixir or write Markdown, you might find this helpful!</p>
<p>Letâ€™s start with some basics:</p>
<h2>Environment</h2>
<ul>
<li><a href="https://neovim.io">neovim</a> - right now Iâ€™m using 0.4.0 so I can use floating windows.</li>
<li><a href="https://sw.kovidgoyal.net/kitty/">kitty</a> Terminal Emulator</li>
<li>built-in terminal in neovim</li>
<li><a href="https://www.archlinux.org">ArchLinux</a> - My distro of choice. Shouldnâ€™t matter for this article.</li>
<li><a href="https://github.com/Airblader/i3">i3</a> - My window manager. Shouldnâ€™t matter for this article.</li>
<li><a href="https://github.com/junegunn/vim-plug">Plug</a> - for managing neovim plugins.</li>
<li><a href="https://github.com/neoclide/coc.nvim">nvim-coc</a> for languageserver integration.</li>
<li><a href="https://github.com/dbernheisel/dotfiles">dotfiles</a> - My dotfiles if you want the complete picture</li>
</ul>
<p>There are three ways that I can split my workspace: (1) via my window manager
<a href="https://github.com/Airblader/i3">i3</a>, (2) via my terminal emulator <a href="https://sw.kovidgoyal.net/kitty/">kitty</a>, (3) via <a href="https://neovim.io">neovim</a> with
splits/buffers. Generally I adhere to this practice:</p>
<ol>
<li>Split with i3 if itâ€™s an application, especially a GUI app. This gives me
the ability to move the window to another desktop if I want.</li>
<li>Split with built-in neovim terminal for tests.</li>
<li>Donâ€™t split with kitty ever. Itâ€™d be too confusing for me to have 3 sets of
keyboard shortcuts to keep track of for switching windows/panes/splits.
Maybe one day Iâ€™ll replace the built-in neovim terminal with a kitty split
or an i3 split.</li>
</ol>
<h2>Testing</h2>
<p>I use <a href="https://github.com/janko/vim-test">vim-test</a> and itâ€™s pretty incredible. I picked this workflow up while
working at thoughtbot from some good friends and the <a href="https://github.com/thoughtbot/dotfiles">thoughtbot dotfiles</a>,
and it changed the way I code. The whole TDD workflow is great despite that I
still have trouble actually writing tests first - I tend to spike, iterate,
iterate, THEN write tests, then open a PR. Yeaâ€” this probably means Iâ€™m not a
10x developer ðŸ˜›</p>
<p>I also use neoterm to help open up terminal splits. When Iâ€™m at home, I have an
ultrawide that I use so splitting windows vertically is the way to go; but when
Iâ€™m mobile with my laptop then I typically split horizontally. I want tests to
be visible either way, so I need this to be flexible.</p>
<p>The vim-test neoterm strategy defaults to sending tests to the last-used neoterm
buffer; I can have more terminal buffers, but the first one I open is what
vim-test will use going forward.</p>
<p>Hereâ€™s how I configure vim-test with neoterm. (my <a href="https://github.com/dbernheisel/dotfiles">dotfiles</a> for reference)</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token comment">" ~/.config/nvim/init.vim</span>

<span class="token comment">" Test</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>test#strategy <span class="token operator">=</span> <span class="token string">"neoterm"</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_shell <span class="token operator">=</span> <span class="token string">'$SHELL -l'</span> <span class="token comment">" use the login shell</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_default_mod <span class="token operator">=</span> <span class="token string">'vert'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_autoscroll <span class="token operator">=</span> <span class="token number">1</span>      <span class="token comment">" autoscroll to the bottom when entering insert mode</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_size <span class="token operator">=</span> <span class="token number">80</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_fixedsize <span class="token operator">=</span> <span class="token number">1</span>       <span class="token comment">" fixed size. The autosizing was wonky for me</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_keep_term_open <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">" when buffer closes, exit the terminal too.</span>
<span class="token keyword">let</span> test#<span class="token keyword">ruby</span>#rspec#<span class="token keyword">options</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'suite'</span><span class="token punctuation">:</span> <span class="token string">'--profile 5'</span> <span class="token punctuation">}</span>

<span class="token comment">" Create some commands that makes the splits easy</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">OpenTermV</span><span class="token punctuation">(</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">.</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_size <span class="token operator">=</span> <span class="token number">80</span>
  <span class="token keyword">let</span> <span class="token keyword">l</span><span class="token punctuation">:</span>cmd <span class="token operator">=</span> a<span class="token punctuation">:</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">?</span> <span class="token string">'pwd'</span> <span class="token punctuation">:</span> a<span class="token punctuation">:</span><span class="token number">1</span>
  execute <span class="token string">'vert T '</span><span class="token operator">.</span><span class="token keyword">l</span><span class="token punctuation">:</span>cmd
<span class="token keyword">endfunction</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">OpenTermH</span><span class="token punctuation">(</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">.</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> g<span class="token punctuation">:</span>neoterm_size <span class="token operator">=</span> <span class="token number">10</span>
  <span class="token keyword">let</span> <span class="token keyword">l</span><span class="token punctuation">:</span>cmd <span class="token operator">=</span> a<span class="token punctuation">:</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">?</span> <span class="token string">'pwd'</span> <span class="token punctuation">:</span> a<span class="token punctuation">:</span><span class="token number">1</span>
  execute <span class="token string">'belowright T '</span><span class="token operator">.</span><span class="token keyword">l</span><span class="token punctuation">:</span>cmd
<span class="token keyword">endfunction</span>

command<span class="token operator">!</span> <span class="token operator">-</span>nargs<span class="token operator">=</span><span class="token operator">?</span> VT <span class="token keyword">call</span> <span class="token function">OpenTermV</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">q</span><span class="token operator">-</span><span class="token keyword">args</span><span class="token operator">></span><span class="token punctuation">)</span>
command<span class="token operator">!</span> <span class="token operator">-</span>nargs<span class="token operator">=</span><span class="token operator">?</span> HT <span class="token keyword">call</span> <span class="token function">OpenTermH</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">q</span><span class="token operator">-</span><span class="token keyword">args</span><span class="token operator">></span><span class="token punctuation">)</span>

<span class="token comment">" Use the project's test suite script if it exists</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">RunTestSuite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  Tclear
  <span class="token keyword">if</span> <span class="token function">filereadable</span><span class="token punctuation">(</span><span class="token string">'bin/test_suite'</span><span class="token punctuation">)</span>
    T echo <span class="token string">'bin/test_suite'</span>
    T <span class="token builtin">bin</span><span class="token operator">/</span>test_suite
  <span class="token keyword">elseif</span> <span class="token function">filereadable</span><span class="token punctuation">(</span><span class="token string">"bin/test"</span><span class="token punctuation">)</span>
    T echo <span class="token string">'bin/test'</span>
    T <span class="token builtin">bin</span><span class="token operator">/</span>test
  <span class="token keyword">else</span>
    TestSuite
  <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span>

nmap <span class="token operator">&lt;</span><span class="token keyword">silent</span><span class="token operator">></span> <span class="token operator">&lt;</span>leader<span class="token operator">></span><span class="token keyword">t</span> <span class="token punctuation">:</span><span class="token keyword">call</span> TestNearest<span class="token operator">&lt;</span>CR<span class="token operator">></span>
nmap <span class="token operator">&lt;</span><span class="token keyword">silent</span><span class="token operator">></span> <span class="token operator">&lt;</span>leader<span class="token operator">></span>T <span class="token punctuation">:</span><span class="token keyword">call</span> TestFile<span class="token operator">&lt;</span>CR<span class="token operator">></span>
nmap <span class="token operator">&lt;</span><span class="token keyword">silent</span><span class="token operator">></span> <span class="token operator">&lt;</span>leader<span class="token operator">></span>a <span class="token punctuation">:</span><span class="token keyword">call</span> <span class="token function">RunTestSuite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>CR<span class="token operator">></span>
nmap <span class="token operator">&lt;</span><span class="token keyword">silent</span><span class="token operator">></span> <span class="token operator">&lt;</span>leader<span class="token operator">></span><span class="token keyword">l</span> <span class="token punctuation">:</span><span class="token keyword">call</span> TestLast<span class="token operator">&lt;</span>CR<span class="token operator">></span></code></pre></div>
<p>Iâ€™ve found it conventional to have a <code class="language-text">bin/test_suite</code> or <code class="language-text">bin/test</code> script in
the project that takes care of a lot of details like environment exports,
cleanup, or making sure the test environmentâ€™s database is setup as well as
running all the tests. Even if the test suite isnâ€™t complicated, itâ€™s still
helpful for new developers on the project.</p>
<p>If that script is present and when I want to run all tests, I should execute
that file; otherwise use the default vim-test suite command. For non-suite
tests, I use the default vim-test commands.</p>
<p><code class="language-text">&lt;space&gt;a</code> triggers <strong>a</strong>ll tests. If a neoterm split isnâ€™t open,
then itâ€™ll automatically open one with the default settingsâ€” in my case, a
vertical split at 80 columns wide. If a neoterm split is already open, then
itâ€™ll send the test to that split. In situations where my vertical space is
lacking, I prep by opening up a split, and then hit my test shortcut. <code class="language-text">:HT</code> to
open the terminal up.</p>
<p>If Iâ€™m testing a method or function, then <code class="language-text">&lt;space&gt;t</code> to send the nearest
<strong>t</strong>est to it. If Iâ€™m trying to make a test pass, Iâ€™ll modify the code and then
<code class="language-text">&lt;space&gt;l</code> to run the <strong>l</strong>ast test. If Iâ€™m refactoring a class or module, Iâ€™ll
run all the <strong>T</strong>ests for it. I havenâ€™t found myself using vim-testâ€™s TestVisit.
If you have some examples on where that command helps, Iâ€™d love to hear it!</p>
<p><a href="https://asciinema.org/a/gs6r5QlC8oR8HPNYhRPDypY6n"><img src="https://asciinema.org/a/gs6r5QlC8oR8HPNYhRPDypY6n.svg" alt="asciicast"></a></p>
<h2>Transformations</h2>
<p>This is a great start! But eventually there might be a pesky app where I need to
opt-into an environment variable, but only when Iâ€™m running a small number of
tests. vim-test lets me define my own transformations to the commands. I can
check for a certain file and string in it to determine what project Iâ€™m in. If
Iâ€™m in that project, then change the command where I can.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token comment">" ~/.config/nvim/after/ftplugin/ruby.vim</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">MyAppRspec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span> abort
  <span class="token comment">" If I'm in the pesky app and</span>
  <span class="token comment">" not running the entire test suite indicated by the --profile flag</span>
  <span class="token comment">" Add the SKIP_FIXTURES env var.</span>
  <span class="token keyword">call</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat README.md | grep 'MyApp'"</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token function">match</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>cmd<span class="token punctuation">,</span> <span class="token string">'--profile'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">:</span>shell_error <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token function">substitute</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>cmd<span class="token punctuation">,</span> <span class="token string">'bundle exec'</span><span class="token punctuation">,</span> <span class="token string">'SKIP_FIXTURES=true bundle exec'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> a<span class="token punctuation">:</span>cmd
  <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">let</span> g<span class="token punctuation">:</span>test#custom_transformations <span class="token operator">=</span> <span class="token punctuation">{</span>
      \ <span class="token string">'myapp_ruby'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'MyAppRspec'</span><span class="token punctuation">)</span>
      \ <span class="token punctuation">}</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>test#transformation <span class="token operator">=</span> <span class="token string">'myapp_ruby'</span></code></pre></div>
<p>On the Elixir side, umbrella apps can be a little tricky. vim-test will send the
path of the test to <code class="language-text">mix test {file}</code>, but <code class="language-text">mix</code> will run that command for each
of the apps in the umbrella. Thatâ€™s probably not what we want to do since that
test exists for only one for apps. Again, we can solve it with a transformation.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token comment">" ~/.config/nvim/after/ftplugin/elixir.vim</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">ElixirUmbrellaTransform</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span> abort
  <span class="token comment">" if in an umbrella project indicated by the existence of an ./apps folder</span>
  <span class="token comment">" limit the mix command to the app to which the test belongs</span>
  <span class="token keyword">if</span> <span class="token function">match</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>cmd<span class="token punctuation">,</span> <span class="token string">'apps/'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment">" capture the app from the file path, and send it to the --app flag instead</span>
    <span class="token keyword">return</span> <span class="token function">substitute</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>cmd<span class="token punctuation">,</span> <span class="token string">'mix test apps/\([^/]*\)/'</span><span class="token punctuation">,</span> <span class="token string">'mix cmd --app \1 mix test --color '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> a<span class="token punctuation">:</span>cmd
  end
<span class="token keyword">endfunction</span>

<span class="token keyword">let</span> g<span class="token punctuation">:</span>test#custom_transformations <span class="token operator">=</span> <span class="token punctuation">{</span>
       \ <span class="token string">'elixir_umbrella'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'ElixirUmbrellaTransform'</span><span class="token punctuation">)</span>
       \ <span class="token punctuation">}</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>test#transformation <span class="token operator">=</span> <span class="token string">'elixir_umbrella'</span></code></pre></div>
<p>Thatâ€™s it for tests!</p>
<p>Hope you picked up something nifty. If you have any tips for me, send them my
way <a href="https://twitter.com/bernheisel">@bernheisel</a></p></div></article><div class="flex flex-wrap justify-between"><div class="w-full p-2 lg:w-1/2"><a class="text-white no-underline inline-flex items-center flex-1 button bg-purple-darker" href="/blog/httpoison-decompression/"><svg class="w-6 h-6 mr-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 960v-128q0-26-19-45t-45-19h-502l189-189q19-19 19-45t-19-45l-91-91q-18-18-45-18t-45 18l-362 362-91 91q-18 18-18 45t18 45l91 91 362 362q18 18 45 18t45-18l91-91q18-18 18-45t-18-45l-189-189h502q26 0 45-19t19-45zm256-64q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg><span>HTTPoison and Decompression</span></a></div><div class="w-full p-2 lg:w-1/2"><a class="text-white no-underline inline-flex items-center flex-1 button bg-purple-darker" href="/blog/date-time-parser-podcast/"><span>DateTimeParser on Elixir Mix podcast</span><svg class="w-6 h-6 ml-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1413 896q0-27-18-45l-91-91-362-362q-18-18-45-18t-45 18l-91 91q-18 18-18 45t18 45l189 189h-502q-26 0-45 19t-19 45v128q0 26 19 45t45 19h502l-189 189q-19 19-19 45t19 45l91 91q18 18 45 18t45-18l362-362 91-91q18-18 18-45zm251 0q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg></a></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/vim-workflow/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e49f8733b8aee9471acf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-8dc5b1de7df84c955e11.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-2780d9b33f550a804e84.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f9633554493dddb1c536.js"],"component---src-pages-index-js":["/component---src-pages-index-js-da8729d9d0343d295966.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-155bd245edb675f44036.js"]};/*]]>*/</script><script src="/webpack-runtime-591c32b048d2d82d0b81.js" async=""></script><script src="/app-e49f8733b8aee9471acf.js" async=""></script><script src="/framework-1cbcc4f69858806ac5db.js" async=""></script><script src="/1777bc0a756dace6068a54d243c7071eee1627a0-2735f80a26e928b0d3f0.js" async=""></script><script src="/component---src-templates-blog-post-js-2780d9b33f550a804e84.js" async=""></script><script src="/styles-48fa8a050a65bb8447bd.js" async=""></script></body></html>