<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.4d9ef65815fd18f73322.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@font-face{font-family:Fira Code;src:url(/FiraCode-Light.woff2) format("woff2"),url(/FiraCode-Light.woff) format("woff");font-weight:300;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Regular.woff2) format("woff2"),url(/FiraCode-Regular.woff) format("woff");font-weight:400;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Medium.woff2) format("woff2"),url(/FiraCode-Medium.woff) format("woff");font-weight:500;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-SemiBold.woff2) format("woff2"),url(/FiraCode-SemiBold.woff) format("woff");font-weight:600;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Bold.woff2) format("woff2"),url(/FiraCode-Bold.woff) format("woff");font-weight:700;font-style:normal}@font-face{font-family:Fira Code VF;src:url(/FiraCode-VF.woff2) format("woff2-variations"),url(/FiraCode-VF.woff) format("woff-variations");font-weight:300 700;font-style:normal}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1.125rem;line-height:1.5;letter-spacing:.025em;--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity));background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}code,pre{font-weight:400;letter-spacing:0;font-family:Fira Code!important;border:none!important}.avatar{border-width:2px;--border-opacity:1;border-color:#f7fafc;border-color:rgba(247,250,252,var(--border-opacity));border-radius:9999px;-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.button{padding:.5rem .75rem;font-weight:500;--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));text-decoration:none;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#718096;border-color:rgba(113,128,150,var(--border-opacity));border-radius:.25rem;-webkit-box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity));cursor:default}.button:hover{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.post-container{--border-opacity:1;border-color:#4a5568;border-bottom:2px;border-style:dotted;border-color:rgba(74,85,104,var(--border-opacity))}.link{font-weight:500;--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.link:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.link:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}h1.post-content:before,h1.post-header:before,h2.post-content:before,h2.post-header:before,h3.post-content:before,h3.post-header:before,h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{--text-opacity:1;color:#cbd5e0;color:rgba(203,213,224,var(--text-opacity))}h1.post-content:before,h1.post-header:before{margin-right:1rem;content:"#"}h2.post-content:before,h2.post-header:before{margin-right:.75rem;content:"##"}h3.post-content:before,h3.post-header:before{margin-right:.5rem;content:"###"}h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{margin-right:.25rem;content:"####"}.blog-post h1{font-weight:600;font-size:2.25rem}.blog-post h2{font-weight:600;font-size:1.875rem}.blog-post h3{font-weight:600;font-size:1.5rem}.blog-post h4,.blog-post h5{font-weight:600;font-size:1.25rem}.blog-post h6{font-weight:600;font-size:1.125rem}.post-content blockquote{padding-left:1.5rem;border-left-width:4px;--border-opacity:1;border-color:#9f7aea;border-color:rgba(159,122,234,var(--border-opacity))}.post-content p{margin-top:1rem;margin-bottom:1rem}.post-content ul{list-style-type:disc}.post-content ol,.post-content ul{margin-left:1rem;padding-left:1rem}.post-content ol{list-style-type:decimal}.post-content li{margin-top:.5rem;margin-bottom:.5rem}.post-content strong{font-weight:600}.post-content a{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1)}.post-content a:focus{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity));text-decoration:none}.post-content a.gatsby-resp-image-link:hover{border-width:0}@media (prefers-color-scheme:dark){body{background-color:#1a202c;background-color:rgba(26,32,44,var(--bg-opacity));--text-opacity:1;color:#e2e8f0;color:rgba(226,232,240,var(--text-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity));--bg-opacity:0.25}.avatar{--border-opacity:1;border-color:#2d3748;border-color:rgba(45,55,72,var(--border-opacity))}.button{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:hover{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.post-content a{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:focus{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.link:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity));--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}}.space-x-1>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(0.25rem*var(--space-x-reverse));margin-left:calc(0.25rem*(1 - var(--space-x-reverse)))}.space-y-4>:not(template)~:not(template){--space-y-reverse:0;margin-top:calc(1rem*(1 - var(--space-y-reverse)));margin-bottom:calc(1rem*var(--space-y-reverse))}.space-x-4>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(1rem*var(--space-x-reverse));margin-left:calc(1rem*(1 - var(--space-x-reverse)))}.block{display:block}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.inline-flex{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.hidden{display:none}.flex-col{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.flex-wrap{-ms-flex-wrap:wrap;flex-wrap:wrap}.items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.flex-1{-webkit-box-flex:1;-ms-flex:1 1 0%;flex:1 1 0%}.flex-shrink-0{-ms-flex-negative:0;flex-shrink:0}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-3{height:.75rem}.h-6{height:1.5rem}.h-8{height:2rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-6{line-height:1.5rem}.leading-normal{line-height:1.5}.list-disc{list-style-type:disc}.m-auto{margin:auto}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.ml-0{margin-left:0}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.ml-2{margin-left:.5rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.max-w-3xl{max-width:48rem}.p-2{padding:.5rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.pl-4{padding-left:1rem}.pb-10{padding-bottom:2.5rem}.shadow-md{-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.no-underline{text-decoration:none}.tracking-wider{letter-spacing:.05em}.align-middle{vertical-align:middle}.w-3{width:.75rem}.w-6{width:1.5rem}.w-16{width:4rem}.w-full{width:100%}@media (min-width:768px){.md\:font-extrabold{font-weight:800}.md\:text-4xl{font-size:2.25rem}.md\:ml-4{margin-left:1rem}.md\:w-24{width:6rem}}@media (min-width:1024px){.lg\:inline-block{display:inline-block}.lg\:flex{display:-webkit-box;display:-ms-flexbox;display:flex}.lg\:hidden{display:none}.lg\:items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.lg\:mt-0{margin-top:0}.lg\:w-32{width:8rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}}.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);-webkit-font-feature-settings:normal;font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter:before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty:after{content:" ";-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:" ";position:absolute;width:100%}.grvsc-line-diff-add:before{background-color:rgba(0,255,60,.2);background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del:before{background-color:rgba(255,0,20,.2);background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}</style><meta name="generator" content="Gatsby 2.20.9"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9152758-1', 'auto', {});
      
      
      
      
      
      }</script><link rel="alternate" type="application/rss+xml" title="David Bernheisel&#x27;s Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="36x36" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="48x48" href="/android-chrome-48x48.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="72x72" href="/android-chrome-72x72.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="96x96" href="/android-chrome-96x96.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="144x144" href="/android-chrome-144x144.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png?v=611230f76b9c00b58e5b99e8a179a99d"/><title data-react-helmet="true">Querying an Embedded Map in PostgreSQL with Ecto | David Bernheisel</title><meta data-react-helmet="true" name="description" content="Structs and maps are easy to work with in Elixir, but if they are stored
in the database as JSON and accessed via an Ecto Schema, it’s not as
clear how to query them. We’re going to explore how to do that, and make
it clear and easy."/><meta data-react-helmet="true" name="twitter:creator" content="@bernheisel"/><link as="script" rel="preload" href="/styles-48fa8a050a65bb8447bd.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"/><link as="script" rel="preload" href="/1777bc0a756dace6068a54d243c7071eee1627a0-c8bbedbe2105888d6327.js"/><link as="script" rel="preload" href="/framework-1cbcc4f69858806ac5db.js"/><link as="script" rel="preload" href="/app-e49f8733b8aee9471acf.js"/><link as="script" rel="preload" href="/webpack-runtime-be644e17620554eca688.js"/><link as="fetch" rel="preload" href="/page-data/blog/querying-embedded-maps-in-postgresql-with-ecto/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="flex flex-wrap items-center justify-between p-4 shadow-md navbar"><a class="no-underline" href="/"><div class="flex items-center space-x-1"><div class="flex-shrink-0"><img src="/static/profile-picture-977b63cbce04bae4479e3185b22bfb1a.jpg" alt="David Bernheisel" class="w-16 avatar md:w-24 lg:w-32"/></div><div><h3 class="ml-0 text-xl font-bold md:ml-4 md:text-4xl md:font-extrabold leading-6">David Bernheisel</h3></div></div></a><div class="block lg:hidden"><button class="flex items-center px-3 button"><svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div class="w-full block lg:mt-0 mt-4 lg:flex lg:items-center lg:w-auto hidden"><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/">Blog</a><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/projects/">Projects</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://elixir-utilities.herokuapp.com">Utilities</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://twitter.com/bernheisel">Twitter</a><div class="py-1 mt-4 lg:mt-0"><a href="/rss.xml"><img class="h-8 align-middle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgaWQ9IlJTU2ljb24iCiAgICAgdmlld0JveD0iMCAwIDggOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiPgoKICA8dGl0bGU+UlNTIGZlZWQgaWNvbjwvdGl0bGU+CgogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuYnV0dG9uIHtzdHJva2U6IG5vbmU7IGZpbGw6IG9yYW5nZTt9CiAgICAuc3ltYm9sIHtzdHJva2U6IG5vbmU7IGZpbGw6IHdoaXRlO30KICA8L3N0eWxlPgoKICA8cmVjdCAgIGNsYXNzPSJidXR0b24iIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIxLjUiIC8+CiAgPGNpcmNsZSBjbGFzcz0ic3ltYm9sIiBjeD0iMiIgY3k9IjYiIHI9IjEiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsNCBhIDMsMyAwIDAgMSAzLDMgaCAxIGEgNCw0IDAgMCAwIC00LC00IHoiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsMiBhIDUsNSAwIDAgMSA1LDUgaCAxIGEgNiw2IDAgMCAwIC02LC02IHoiIC8+Cgo8L3N2Zz4=" alt="RSS"/></a></div></div></nav><main class="max-w-3xl p-4 m-auto text-lg"><article class="blog-post"><h1 class="post-content text-3xl">Querying an Embedded Map in PostgreSQL with Ecto</h1><p class="mt-2 mb-4 text-sm frontmatter"><span>Published on <!-- -->March 09, 2018</span><span><span class="mx-2">|</span><a href="https://robots.thoughtbot.com/querying-embedded-maps-in-postgresql-with-ecto">Original Publishing</a></span><span><span class="mx-2">|</span>5<!-- -->m read</span></p><div class="post-content"><p>Structs and maps are easy to work with in Elixir, but if they are stored
in the database as JSON and accessed via an Ecto Schema, it’s not as
clear how to query them. We’re going to explore how to do that, and make
it clear and easy.</p>
<!-- excerpt -->
<p>PostgreSQL has <a href="https://www.postgresql.org/docs/current/static/functions-json.html">great support for objects stored as JSON</a>.
This is useful for those moments when you need to store data that could
be variably structured, such as responses from other services’ APIs, or
data that frequently travels together within your relational tables.</p>
<p>A common trade-off for mixing scalar column data types (like <code>varchar</code>
or <code>integer</code>) with column data types that handle more-complicated
objects (like <abbr title="JavaScript Object Notation">JSON</abbr>) is
that <abbr title="Object-relational Mapping">ORMs</abbr> or data mappers
sometimes can’t introspect on them for you, which means it becomes much
harder to query that data.</p>
<p>Using Ecto’s <code>embedded_schema</code> helps introspect on those known values,
but it doesn’t really assist you with querying those fields in SQL. This
is where I became extremely greatful for <a href="https://hexdocs.pm/ecto/Ecto.Query.html#module-fragments">Ecto’s escape
hatch</a>: <code>fragment()</code>.</p>
<h2>Define the Struct or Map in Ecto</h2>
<p>Let’s dive into some code as an example:</p>
<p>I have a <code>Vehicle.Photo</code> schema that has several versions of the photo:</p>
<ul>
<li>craigslist_ad</li>
<li>facebook_ad</li>
<li>facebook_carousel_ad</li>
<li>extra_large</li>
<li>extra_small</li>
<li>large</li>
<li>medium</li>
<li>original</li>
<li>small</li>
</ul>
<p>We decided to store the versions’ <abbr title="Uniform Resource
Locators">URLs</abbr> inside a map in the database,
because we’re going to use a set of the URLs at the same time inside of
an HTML <code>&#x3C;img srcset /></code>. <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">You can read more about srcset from
MDN and how it helps with responsive images</a>.</p>
<p>The Ecto migration looks like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">up</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  alter table(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:vehicle_photos</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    add </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:standard_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:map</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    add </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:facebook_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:map</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    add </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:craigslist_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:map</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>The Ecto schema looks like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">schema </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;vehicle_photos&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:file</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">PhotoUploader</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Type</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  embeds_one </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:standard_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">StandardUrls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">on_replace:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:update</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:extra_large</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:extra_small</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:large</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:medium</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:original</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:small</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  embeds_one </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:facebook_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">FacebookUrls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">on_replace:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:update</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:hero_ad</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:carousel_ad</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  embeds_one </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:craigslist_urls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">CraigslistUrls</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">on_replace:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:update</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ad</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>Since this is a known structure, Ecto can introspect on the JSON values and
cast and dump them to the appropriate Elixir data types, which is immensely
helpful. Here I am achieving that by using <code>embeds_one</code> and specifying the
struct. Once pulled from the database, Ecto will decode them.</p>
<p>Other times, you may not be able to do this ahead of time, so the schema
might look like this (the <code>api_response</code> field):</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">schema </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;vehicle_photos&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:file</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">PhotoUploader</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Type</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  field(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:api_response</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:map</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<h2>Query the JSON</h2>
<p>Continuing with the struct example schema, we found out that some of our
URLs weren’t being populated like we expected, so I had to find those
photos and fix them. How do I query for them since they’re stored in
PostgreSQL as JSON? We need to drop down into raw SQL:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">where_photo_urls_have_a_null</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">query</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  query</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> where([</span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_q</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">], fragment(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (facebook_urls IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (facebook_urls-&gt;&gt;&#39;ad_version&#39; IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (facebook_urls-&gt;&gt;&#39;hero_version&#39; IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (craigslist_urls-&gt;&gt;&#39;ad&#39; IS NULL)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    &quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  ))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>The SQL operator <code>->></code> will leverage <a href="https://www.postgresql.org/docs/current/static/functions-json.html">PostgreSQL’s JSON
functions</a> to retrieve the text or integers that are stored
in the JSON. You can access them using this syntax: <code>column->>key</code>. In
my case, I needed to find if the column was null, or it wasn’t null,
then to ask if the JSON object has any keys that are null.  This will
work regardless of whether you use an embedded struct or a map, because
PostgreSQL sees it as the same thing: JSON.</p>
<p>Here’s an example that checks for substrings:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">where_photo_url_wrong</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">query</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  query</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> where([</span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_q</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">], fragment(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (facebook_urls-&gt;&gt;&#39;hero_ad&#39; NOT ILIKE ?) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (facebook_urls-&gt;&gt;&#39;carousel_ad&#39; NOT ILIKE ?) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    (craigslist_urls-&gt;&gt;&#39;ad&#39; NOT ILIKE ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">    &quot;&quot;&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%facebook_hero_ad%&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%facebook_carousel_ad%&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%craigslist_ad%&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  ))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<h2>Make the Query Composable</h2>
<p>Above is all I needed for my use case, but I wondered how I could continue
querying those fields in a reusable way. For example, how do I chain these
together in an <code>OR</code> statement that uses both of these fragments?</p>
<p>To do that, I’ll need to extract the <code>fragment</code> expressions and put them
into a macro so they can be used within Ecto’s functions.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyProject.SampleQuery.Fragments</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">import</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Ecto</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Query</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">API</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">only:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> [</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">fragment:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">1</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmacro</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">photo_urls_have_a_null</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">quote</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      fragment(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (facebook_urls IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (facebook_urls-&gt;&gt;&#39;ad_version&#39; IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (facebook_urls-&gt;&gt;&#39;hero_version&#39; IS NULL) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (craigslist_urls-&gt;&gt;&#39;ad&#39; IS NULL)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        &quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmacro</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">photo_urls_not_contain</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">([</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">hero_ad_value</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">carousel_ad_value</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">ad_value</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">]) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">quote</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      fragment(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (facebook_urls-&gt;&gt;&#39;hero_ad&#39; NOT ILIKE ?) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (facebook_urls-&gt;&gt;&#39;carousel_ad&#39; NOT ILIKE ?) OR</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        (craigslist_urls-&gt;&gt;&#39;ad&#39; NOT ILIKE ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">        &quot;&quot;&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        ^</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">#{</span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unquote</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">(hero_ad_value)</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">}</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">%&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        ^</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">#{</span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unquote</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">(carousel_ad_value)</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">}</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">%&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        ^</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;%</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">#{</span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unquote</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">(ad_value)</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">}</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">%&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>Now that those fragments are extracted, let’s use them:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">import</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyProject</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">SampleQuery</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Fragments</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">alias</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyProject</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Photo</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyProject.SampleQuery</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">find_bad_photos</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">query</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">\\</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Photo</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    query</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> where([</span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_p</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">], photo_urls_have_a_null())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> or_where([</span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_p</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">], photo_urls_not_contain([</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;facebook_hero_ad&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;facebook_carousel_ad&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;craigslist_ad&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    ]))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Repo</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.all</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p><strong>Beautiful.</strong></p>
<p>If you’d like to check out the code a little more, you can see this
<a href="https://github.com/dbernheisel/sample_json_ecto_queries">sample Ecto and Phoenix repo with tests</a>.</p>
<p>This article only explains how to query a JSON object in the database
and how it works with Ecto querying. If you’re needing to store an array
of maps or structs, then check out Jon’s post <a href="https://robots.thoughtbot.com/why-ecto-s-way-of-storing-embedded-lists-of-maps-makes-querying-hard">Why Ecto’s Way of
Storing Embedded Lists of Maps Makes Querying Hard</a>.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .atom-one-light {
    background-color: #FAFAFA;
    color: #383A42;
  }
  .atom-one-light .grvsc-t5WxC3-i { font-style: italic; }
  .atom-one-light .grvsc-t5WxC3-14 { color: #A626A4; }
  .atom-one-light .grvsc-t5WxC3-1 { color: #383A42; }
  .atom-one-light .grvsc-t5WxC3-9 { color: #4078F2; }
  .atom-one-light .grvsc-t5WxC3-8 { color: #0184BC; }
  .atom-one-light .grvsc-t5WxC3-10 { color: #50A14F; }
  .atom-one-light .grvsc-t5WxC3-5 { color: #E45649; }
  .atom-one-light .grvsc-t5WxC3-6 { color: #986801; }
  .atom-one-light .grvsc-t5WxC3-7 { color: #A0A1A7; }
  .atom-one-light .grvsc-t5WxC3-4 { color: #C18401; }
  .atom-one-light .grvsc-t5WxC3-15 { color: #CA1243; }
  .atom-one-light .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));
  }
  
  /* Monokai Phoenix */
  @media (prefers-color-scheme: dark) {
    .grvsc-mm-t88nfI {
      background-color: #1e1e1e;
      color: #F8F8F2;
    }
    .grvsc-mm-t88nfI .grvsc-t88nfI-7 { color: #F92672; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-1 { color: #F8F8F2; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-5 { color: #A6E22E; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-4 { color: #AE81FF; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-6 { color: #E6DB74; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-3 { color: #75715E; }
    .grvsc-mm-t88nfI .grvsc-line-highlighted::before {
      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
    }
  }
</style></div></article><div class="flex flex-wrap justify-between"><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/testing-emails-with-bamboo/"><svg class="w-6 h-6 mr-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 960v-128q0-26-19-45t-45-19h-502l189-189q19-19 19-45t-19-45l-91-91q-18-18-45-18t-45 18l-362 362-91 91q-18 18-18 45t18 45l91 91 362 362q18 18 45 18t45-18l91-91q18-18 18-45t-18-45l-189-189h502q26 0 45-19t19-45zm256-64q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg><span>Testing Random Data in Emails with Bamboo</span></a></div><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/ruby-rails-and-circle-ci-workflows/"><span>Ruby, Rails, and CircleCI 2.0 Workflows</span><svg class="w-6 h-6 ml-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1413 896q0-27-18-45l-91-91-362-362q-18-18-45-18t-45 18l-91 91q-18 18-18 45t18 45l189 189h-502q-26 0-45 19t-19 45v128q0 26 19 45t45 19h502l-189 189q-19 19-19 45t19 45l91 91q18 18 45 18t45-18l362-362 91-91q18-18 18-45zm251 0q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg></a></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/querying-embedded-maps-in-postgresql-with-ecto/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e49f8733b8aee9471acf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-8dc5b1de7df84c955e11.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f9633554493dddb1c536.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f71e923739c6685c4443.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ce130e74c0d10fe8ba37.js"]};/*]]>*/</script><script src="/webpack-runtime-be644e17620554eca688.js" async=""></script><script src="/app-e49f8733b8aee9471acf.js" async=""></script><script src="/framework-1cbcc4f69858806ac5db.js" async=""></script><script src="/1777bc0a756dace6068a54d243c7071eee1627a0-c8bbedbe2105888d6327.js" async=""></script><script src="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js" async=""></script><script src="/styles-48fa8a050a65bb8447bd.js" async=""></script></body></html>