<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.4d9ef65815fd18f73322.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@font-face{font-family:Fira Code;src:url(/FiraCode-Light.woff2) format("woff2"),url(/FiraCode-Light.woff) format("woff");font-weight:300;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Regular.woff2) format("woff2"),url(/FiraCode-Regular.woff) format("woff");font-weight:400;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Medium.woff2) format("woff2"),url(/FiraCode-Medium.woff) format("woff");font-weight:500;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-SemiBold.woff2) format("woff2"),url(/FiraCode-SemiBold.woff) format("woff");font-weight:600;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Bold.woff2) format("woff2"),url(/FiraCode-Bold.woff) format("woff");font-weight:700;font-style:normal}@font-face{font-family:Fira Code VF;src:url(/FiraCode-VF.woff2) format("woff2-variations"),url(/FiraCode-VF.woff) format("woff-variations");font-weight:300 700;font-style:normal}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1.125rem;line-height:1.5;letter-spacing:.025em;--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity));background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}code,pre{font-weight:400;letter-spacing:0;font-family:Fira Code!important;border:none!important}.avatar{border-width:2px;--border-opacity:1;border-color:#f7fafc;border-color:rgba(247,250,252,var(--border-opacity));border-radius:9999px;-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.button{padding:.5rem .75rem;font-weight:500;--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));text-decoration:none;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#718096;border-color:rgba(113,128,150,var(--border-opacity));border-radius:.25rem;-webkit-box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity));cursor:default}.button:hover{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.post-container{--border-opacity:1;border-color:#4a5568;border-bottom:2px;border-style:dotted;border-color:rgba(74,85,104,var(--border-opacity))}.link{font-weight:500;--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.link:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.link:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}h1.post-content:before,h1.post-header:before,h2.post-content:before,h2.post-header:before,h3.post-content:before,h3.post-header:before,h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{--text-opacity:1;color:#cbd5e0;color:rgba(203,213,224,var(--text-opacity))}h1.post-content:before,h1.post-header:before{margin-right:1rem;content:"#"}h2.post-content:before,h2.post-header:before{margin-right:.75rem;content:"##"}h3.post-content:before,h3.post-header:before{margin-right:.5rem;content:"###"}h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{margin-right:.25rem;content:"####"}.blog-post h1{font-weight:600;font-size:2.25rem}.blog-post h2{font-weight:600;font-size:1.875rem}.blog-post h3{font-weight:600;font-size:1.5rem}.blog-post h4,.blog-post h5{font-weight:600;font-size:1.25rem}.blog-post h6{font-weight:600;font-size:1.125rem}.post-content blockquote{padding-left:1.5rem;border-left-width:4px;--border-opacity:1;border-color:#9f7aea;border-color:rgba(159,122,234,var(--border-opacity))}.post-content p{margin-top:1rem;margin-bottom:1rem}.post-content ul{list-style-type:disc}.post-content ol,.post-content ul{margin-left:1rem;padding-left:1rem}.post-content ol{list-style-type:decimal}.post-content li{margin-top:.5rem;margin-bottom:.5rem}.post-content strong{font-weight:600}.post-content a{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1)}.post-content a:focus{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity));text-decoration:none}.post-content a.gatsby-resp-image-link:hover{border-width:0}@media (prefers-color-scheme:dark){body{background-color:#1a202c;background-color:rgba(26,32,44,var(--bg-opacity));--text-opacity:1;color:#e2e8f0;color:rgba(226,232,240,var(--text-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity));--bg-opacity:0.25}.avatar{--border-opacity:1;border-color:#2d3748;border-color:rgba(45,55,72,var(--border-opacity))}.button{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:hover{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.post-content a{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:focus{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.link:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity));--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}}.space-x-1>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(0.25rem*var(--space-x-reverse));margin-left:calc(0.25rem*(1 - var(--space-x-reverse)))}.space-y-4>:not(template)~:not(template){--space-y-reverse:0;margin-top:calc(1rem*(1 - var(--space-y-reverse)));margin-bottom:calc(1rem*var(--space-y-reverse))}.space-x-4>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(1rem*var(--space-x-reverse));margin-left:calc(1rem*(1 - var(--space-x-reverse)))}.block{display:block}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.inline-flex{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.hidden{display:none}.flex-col{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.flex-wrap{-ms-flex-wrap:wrap;flex-wrap:wrap}.items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.flex-1{-webkit-box-flex:1;-ms-flex:1 1 0%;flex:1 1 0%}.flex-shrink-0{-ms-flex-negative:0;flex-shrink:0}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-3{height:.75rem}.h-6{height:1.5rem}.h-8{height:2rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-6{line-height:1.5rem}.leading-normal{line-height:1.5}.list-disc{list-style-type:disc}.m-auto{margin:auto}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.ml-0{margin-left:0}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.ml-2{margin-left:.5rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.max-w-3xl{max-width:48rem}.p-2{padding:.5rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.pl-4{padding-left:1rem}.pb-10{padding-bottom:2.5rem}.shadow-md{-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.no-underline{text-decoration:none}.tracking-wider{letter-spacing:.05em}.align-middle{vertical-align:middle}.w-3{width:.75rem}.w-6{width:1.5rem}.w-16{width:4rem}.w-full{width:100%}@media (min-width:768px){.md\:font-extrabold{font-weight:800}.md\:text-4xl{font-size:2.25rem}.md\:ml-4{margin-left:1rem}.md\:w-24{width:6rem}}@media (min-width:1024px){.lg\:inline-block{display:inline-block}.lg\:flex{display:-webkit-box;display:-ms-flexbox;display:flex}.lg\:hidden{display:none}.lg\:items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.lg\:mt-0{margin-top:0}.lg\:w-32{width:8rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}}.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);-webkit-font-feature-settings:normal;font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter:before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty:after{content:" ";-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:" ";position:absolute;width:100%}.grvsc-line-diff-add:before{background-color:rgba(0,255,60,.2);background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del:before{background-color:rgba(255,0,20,.2);background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}</style><meta name="generator" content="Gatsby 2.20.9"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9152758-1', 'auto', {});
      
      
      
      
      
      }</script><link rel="alternate" type="application/rss+xml" title="David Bernheisel&#x27;s Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="36x36" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="48x48" href="/android-chrome-48x48.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="72x72" href="/android-chrome-72x72.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="96x96" href="/android-chrome-96x96.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="144x144" href="/android-chrome-144x144.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png?v=611230f76b9c00b58e5b99e8a179a99d"/><title data-react-helmet="true">Phoenix LiveView: Multi-step forms | David Bernheisel</title><meta data-react-helmet="true" name="description" content="Phoenix LiveView has been a dream to work with so far. I really recommend
looking at it for your next web application. Building Tailwind…"/><meta data-react-helmet="true" name="twitter:creator" content="@bernheisel"/><link as="script" rel="preload" href="/styles-48fa8a050a65bb8447bd.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"/><link as="script" rel="preload" href="/1777bc0a756dace6068a54d243c7071eee1627a0-c8bbedbe2105888d6327.js"/><link as="script" rel="preload" href="/framework-1cbcc4f69858806ac5db.js"/><link as="script" rel="preload" href="/app-e49f8733b8aee9471acf.js"/><link as="script" rel="preload" href="/webpack-runtime-be644e17620554eca688.js"/><link as="fetch" rel="preload" href="/page-data/blog/liveview-multi-step-form/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="flex flex-wrap items-center justify-between p-4 shadow-md navbar"><a class="no-underline" href="/"><div class="flex items-center space-x-1"><div class="flex-shrink-0"><img src="/static/profile-picture-977b63cbce04bae4479e3185b22bfb1a.jpg" alt="David Bernheisel" class="w-16 avatar md:w-24 lg:w-32"/></div><div><h3 class="ml-0 text-xl font-bold md:ml-4 md:text-4xl md:font-extrabold leading-6">David Bernheisel</h3></div></div></a><div class="block lg:hidden"><button class="flex items-center px-3 button"><svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div class="w-full block lg:mt-0 mt-4 lg:flex lg:items-center lg:w-auto hidden"><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/">Blog</a><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/projects/">Projects</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://elixir-utilities.herokuapp.com">Utilities</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://twitter.com/bernheisel">Twitter</a><div class="py-1 mt-4 lg:mt-0"><a href="/rss.xml"><img class="h-8 align-middle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgaWQ9IlJTU2ljb24iCiAgICAgdmlld0JveD0iMCAwIDggOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiPgoKICA8dGl0bGU+UlNTIGZlZWQgaWNvbjwvdGl0bGU+CgogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuYnV0dG9uIHtzdHJva2U6IG5vbmU7IGZpbGw6IG9yYW5nZTt9CiAgICAuc3ltYm9sIHtzdHJva2U6IG5vbmU7IGZpbGw6IHdoaXRlO30KICA8L3N0eWxlPgoKICA8cmVjdCAgIGNsYXNzPSJidXR0b24iIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIxLjUiIC8+CiAgPGNpcmNsZSBjbGFzcz0ic3ltYm9sIiBjeD0iMiIgY3k9IjYiIHI9IjEiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsNCBhIDMsMyAwIDAgMSAzLDMgaCAxIGEgNCw0IDAgMCAwIC00LC00IHoiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsMiBhIDUsNSAwIDAgMSA1LDUgaCAxIGEgNiw2IDAgMCAwIC02LC02IHoiIC8+Cgo8L3N2Zz4=" alt="RSS"/></a></div></div></nav><main class="max-w-3xl p-4 m-auto text-lg"><article class="blog-post"><h1 class="post-content text-3xl">Phoenix LiveView: Multi-step forms</h1><p class="mt-2 mb-4 text-sm frontmatter"><span>Published on <!-- -->May 13, 2020</span><span><span class="mx-2">|</span>16<!-- -->m read</span></p><div class="post-content"><p><a href="https://github.com/phoenixframework/phoenix_live_view">Phoenix LiveView</a> has been a dream to work with so far. I <em>really</em> recommend
looking at it for your next web application. Building Tailwind, Elixir, and
Phoenix LiveView with some Vue sprinklings has been the most enjoyable tech
stack I’ve used in a long while.</p>
<p>One of the benefits I love about LiveView is that it enables me to consolidate
some of common front-end logic into the backend, where the source of truth
belongs. A great example is a form, especially long-running or multi-step forms.</p>
<p>Let me show you what I mean.</p>
<p>
		<video
			src=/long-form-demo.mp4
			width="auto"
			height="auto"
			preload="auto"
			muted="true"
			title="Demo of Multi-step form"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<p>This is accomplished without any AJAX calls, no SPAs, and no page reloads.</p>
<p>I coded this form twice. Let me share with you my journey and some techniques I
used to help organize code.</p>
<h2>The Ugly Way (First pass)</h2>
<p>I coded it all with a single LiveView.</p>
<p>It become quite ugly.</p>
<p>I was still trying to figure out what I wanted on the form and still learning
LiveView generally. Eventually, this LiveView became an ugly 1000+-line horror
show that managed state in multiple places.</p>
<p>It was a single <code>&#x3C;form></code> that handled all the fields for the database-backed
record, and each step was hidden until you hit “next”, so every change in the
form sends the entire form values.</p>
<p>The EEX was something like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;div class=&quot;container&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> f </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form_for(</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_validate:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:validate</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_save:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:save</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;who&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">&lt;%# my Who-related form inputs %&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">&lt;%# my What-related form inputs %&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">&lt;%# my When-related form inputs %&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/form&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;/div&gt;</span></span></span></code></pre>
<p>I found that this approach has several drawbacks:</p>
<ul>
<li>When the user hits “enter”, the form will try to submit. If you’re on the
first step, you probably don’t want that to submitted yet until they’re
on the last step. You can override this with some JavaScript, but this
non-standard behavior made things more complicated than it should be. I’ll
need the JavaScript to know which step is last, and track which step it’s
currently on. Ugh… I did this and it wasn’t great. I wanted to delete
myself.</li>
<li>When the user is on a different step, you still need to manage all the “state”
of other steps. This is a lot of “weight” to worry about and ensure
<em>doesn’t</em> change.</li>
<li>As soon as the user interacts with the form on the first step, validations
will occur for the entire form, <strong>even for those inputs on hidden steps</strong>.
This means errors will already be populated before the user even interacted
with them.</li>
<li>Testing the big form was difficult. The tools were great— I just
bad-developered and didn’t break it down well.</li>
</ul>
<p>Generally, I found it harder to “reason about”, especially when I have computed
fields and help text based on user input.</p>
<p>For example, I need to persist two DateTimes with timezones, but I don’t want to
present that to the user as <code>datetime_select</code>s and have them select a timezone
from a drop-down.</p>
<p>Instead I want a date picker, and then separately collect the times and merge it
with the user’s detected timezone (this will later be improved to allow them to
select a timezone and prefer a user’s set timezone while registering). Something
like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> date_select f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:date</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> time_input f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> time_input f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">Your duration is </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span></code></pre>
<p>so in my params, I would receive something like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;validate&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;myform&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">IO</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.inspect params, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">label:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;PARAMS&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, socket}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; PARAMS: %{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#  &quot;date&quot; =&gt; %{&quot;year&quot; =&gt; 2020, &quot;month&quot; =&gt; 1, &quot;day&quot; =&gt; 1},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#  &quot;start_time&quot; =&gt; &quot;08:00&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># &quot; end_time&quot; =&gt; &quot;10:00&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># }</span></span></span></code></pre>
<p>There’s a complicated mechanism in the time pickers that made it harder. I
needed to detect what changed:</p>
<ol>
<li>Was it the <code>end_time</code>? Then let’s extend the duration as well and accept the
new <code>end_time</code>.</li>
<li>Was it the <code>start_time</code>? Then let’s back the <code>end_time</code> up to the same
duration away from the <code>start_time</code>.</li>
<li>At some point, if we accept user input for <code>duration</code>, then we we’d want to
extend the <code>end_time</code> with the new duration.</li>
</ol>
<p>Now I have some fields, I need to compute them into my event struct somehow.
This is how it needs to end up:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.start_at_tz </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; &quot;America/New_York&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.start_at_wall </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; ~N[2020-01-01T08:00:00]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.start_at_utc </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; ~U[2020-01-01T13:00:00Z]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.end_at_tz </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; &quot;America/New_York&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.end_at_wall </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; ~N[2020-01-01T10:00:00]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.end_at_utc </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; ~U[2020-01-01T15:00:00Z]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">record.duration </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">#=&gt; 7200 # seconds which is 2 hours</span></span></span></code></pre>
<p>This is going to be a lot of work!</p>
<p>Let’s not have the giant form all be in one template, or even partials; let’s
split the form up into components. These components will let me manage these
computed fields easier, as well as solve some other UX issues mentioned above.</p>
<h2>Let’s break it down:</h2>
<ul>
<li><a href="#formprogress">Manage form progress in the parent LiveView.</a></li>
<li><a href="#extract">Split the multi-step form into LiveComponents. At least one for each visible step.</a></li>
<li><a href="#clientside">Send input supplied client-side via <code>phx-hook</code>.</a></li>
<li><a href="#clientinput">Handle input changes from the users from the component</a></li>
<li><a href="#subformsubmission">Handle stepped-form submission</a></li>
<li><a href="#formsubmission">Handle final form submission.</a></li>
</ul>
<p><a aria-hidden="true" name="formprogress"></a></p>
<h2>Managing the form progress</h2>
<p>I managed the form step progress by defining a <code>%Step{}</code> and then writing the
order out in the liveview as a module attribute.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyAppWeb.EventLive.Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">@moduledoc &quot;Describe a step in the multi-step form and where it can go.&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defstruct</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> [</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:name</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:prev</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:next</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># in the liveview</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyAppWeb.EventLive.New</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># ...snip...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@steps</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">name:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;who&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">prev:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">nil</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">next:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">name:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">prev:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;who&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">next:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">name:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">prev:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">next:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;where&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">name:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;where&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">prev:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">next:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">nil</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">mount</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">session</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> authenticate(socket, session, [</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:with_organizations</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:with_profile</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    first_step </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">List</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.first(</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@steps</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    event </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> %{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">creator_id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> socket.assigns.current_user.id}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, event)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.changeset(event, params))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, first_step)}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># ...snip...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>When the underlying live components are finished, they’ll send a message to the
parent LiveView which will re-assign <code>:progress</code>; the conditionals in the
template will apply/remove the “hidden” class for the next appropriate step, or
previous step. You’ll see that as you read on.</p>
<p>Let’s chop up the form.</p>
<p><a aria-hidden="true" name="extract"></a></p>
<h2>Extract to LiveComponents</h2>
<p>All this ugly-but-necessary logic should live in “form objects”. In Ecto-land
these can be managed with embedded schemas. These form objects are responsible
for the state of their own fields, and compute their own values without
affecting other steps’ values. The domain becomes much clearer.</p>
<p>When the form is submitted, it will trigger the “save” event from the
LiveComponent. The LiveComponent can then pass the completed params up to its
parent LiveView if the changeset is valid. The parent LiveView can track these
params separately, sitting on it until final save, persisted as a draft, or
whatever you need.</p>
<p>This has some benefits:</p>
<ul>
<li>form submission (hitting enter) no longer needs to override default behavior.</li>
<li>isolates testing to it’s own form and LiveComponent.</li>
<li>your form’s “domain” has clearer boundaries.</li>
<li>user interaction and form validation makes more sense; only the visible form
is “tainted” when the user changes it (opposed to it being tainted before
the user even sees it).</li>
</ul>
<p>The multi-step form now looks like this:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;div class=&quot;container&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;who&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> live_component </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">WhoComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;who&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">event:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">current_user:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@current_user</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> live_component </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">WhatComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;what&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">event:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> live_component </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">WhenComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">event:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">current_user:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@current_user</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div class=&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">unless</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;where&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">do:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;hidden&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> live_component </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">WhereComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;where&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">submit_text:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> t(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;Create&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">event:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@event</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;/div&gt;</span></span></span></code></pre>
<p>Let’s focus on the <code>WhenComponent</code>.</p>
<p>Here’s the big idea:</p>
<ul>
<li>Inside of the WhenComponent, we need our <code>embedded_schema</code> to represent and
store the fields we care about on the step.</li>
<li>When loading/updating the component itself, we’re going to initialize the
changeset with the fields from the record.</li>
<li>When handling validation events, we’re going to throw the params into the
changeset and assign the new changeset back.</li>
<li>The computed values will be updated from the changeset and/or pulled out of
the changeset and assigned into the socket.</li>
<li>When handling the save event, we’re going to ensure the changeset is valid,
and if so, tell the parent LiveView that we’re good to proceed. We’ll send
the struct up to the parent LiveView. This struct will contain the computed
fields so it should be easier for the parent to stitch these steps’ params
together into the final changeset that’s actually persisted.</li>
</ul>
<p>Again, the flow should look like this:</p>
<ol>
<li>On mounting, take the Event and pluck the relevant fields out of it to create
a WhenComponent form backed by an <code>embedded_schema</code>.</li>
<li>When the user is on the step, take the changes as they come and let the user
iterate on the form until it’s valid.</li>
<li>When the changeset is valid and the user tries to submit it, pass the final
struct up to the parent LiveView. The parent LiveView can then switch to the
next step.</li>
</ol>
<p>Here is the component code:</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyAppWeb.EventLive.WhenComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">use</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyAppWeb</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:live_component</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">alias</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Ecto</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@primary_key</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">false</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  embedded_schema </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at_date</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:time</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:utc_datetime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># Not on the form. This is computed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at_date</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:time</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:utc_datetime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># Not on the form. This is computed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    field </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:integer</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># Not on the form. This is computed and displayed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">update</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">assigns</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    whenevent </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> from_event(assigns.event, assigns.current_user.profile.timezone)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> %{}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    changeset </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(whenevent, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(assigns)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, whenevent)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;validate&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when_component&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    adjusted_params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> adjust_time_params(params, socket.assigns.when_changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    changeset </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(socket.assigns.when, adjusted_params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;save&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when_component&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket.assigns.when</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.apply_action(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:insert</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">case</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, record} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        send(self(), {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:proceed</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, record})</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, socket}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:error</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;timezone&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">detected_timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Map</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.put(socket.assigns.when_changeset.params, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;timezone&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, detected_timezone)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    changeset </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(socket.assigns.when_changeset, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@fields</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">~w[timezone start_at_date start_at_time end_at_date end_at_time duration]a</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">whenevent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    whenevent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.cast(params, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@fields</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_stitched_datetime(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_stitched_datetime(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> ensure_duration()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">put_stitched_datetime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">field</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    timezone </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    date </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-4">#{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">field</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-4">}</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">_date&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    time </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:&quot;</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-4">#{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">field</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-4">}</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">_time&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">~T[00:00:00]</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, ndt} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">NaiveDateTime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.new(date, time)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.put_change(changeset, field, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">DateTime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.from_naive!(ndt, timezone))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">from_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">profile_timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-12">__MODULE__</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">timezone:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> event.start_at_tz </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">||</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> profile_timezone </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">||</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;Etc/UTC&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_start_at_date(to_date(event.start_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_start_at_time(to_time(event.start_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_end_at_date(to_date(event.end_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_end_at_time(to_time(event.end_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_end_at(event.end_at)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_start_at(event.start_at)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_duration(calc_duration(event.start_at, event.end_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">ensure_duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">if</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      changeset</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">else</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      start_at </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      end_at </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.put_change(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, calc_duration(start_at, end_at))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">assign_computed</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># I need the start_at for the DatePicker component that I render from this</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># component. I render the timezone and duration on the form. Lastly I</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># compute and render some autocomplete suggestions from the values in the</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># changeset.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_time_autocomplete</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, start_autocompletes(changeset))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_time_autocomplete</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, end_autocompletes(changeset))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># I&#39;ll leave some of these helper functions out, but they&#39;re essentially</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># providing nil-safety, applying defaults, and calculating from other fields</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p><a aria-hidden="true" name="clientside"></a></p>
<h2>Getting the user’s timezone with <code>phx-hook</code></h2>
<p>We can estimate what the user’s timezone is by asking the browser. <strong>NOTE</strong> <em>I
don’t recommend you use this as your only source of user timezone.</em> Use this as
an example for how to get JavaScript-sourced input</p>
<p>Let’s get the timezone. We’ll need some JavaScript.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="javascript" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">window.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">userTimezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-10 grvsc-t88nfI-i">Intl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">DateTimeFormat</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">().</span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">resolvedOptions</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">().</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">timeZone</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">// initialize the Phoenix LiveView socket, and pass this in as a hook:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">hooks.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">UserTimeZone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">mounted</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">() {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-10 grvsc-t88nfI-i">const</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-1">phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-12">this</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-10 grvsc-t88nfI-i">const</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-1">target</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-12">this</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">el</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">dataset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">phoenixTarget</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-10 grvsc-t88nfI-i">const</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-1">els</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> phoenix.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">el</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">querySelectorAll</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;input&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">for</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> (</span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-10 grvsc-t88nfI-i">let</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> el </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">of</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> els) { el.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">value</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> window.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">userTimezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">; }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    phoenix.</span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">pushEventTo</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(target, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;timezone&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, window.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">userTimezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}</span></span></span></code></pre>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">&lt;%# Timezone in the WhenComponent form %&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;div phx-hook=&quot;UserTimeZone&quot; data-phoenix-target=&quot;#</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@id</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&quot; id=&quot;user-time-zone&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;div phx-update=&quot;ignore&quot;&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> hidden_input f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  &lt;/div&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;/div&gt;</span></span></span></code></pre>
<p>When the page is rendered, I’ll get a <code>hidden_input</code> populated with the detected
timezone. This will be included in further form changes and params sent to the
LiveView process. Remember to wrap it with a <code>phx-update="ignore"</code> so the
JavaScript-mutated value isn’t overwritten by LiveView.</p>
<p>You’ll notice that I’m also using <code>pushEventTo</code> after mounting. This is needed
because the user may not have interacted with the form yet to trigger a change,
so until then, I won’t have user’s timezone! I want it pushed immediately so I
can update the form’s changeset. Also, <code>pushEventTo</code> is used instead of
<code>pushEvent</code> because this is a LiveComponent, so I want the event pushed to the
LiveComponent and not the parent LiveView. I pass the target in via a data
attribute so I don’t confuse it with Phoenix’s own <code>phx-target</code>.</p>
<p>When handling the event, we’ll merge the timezone with the existing params of
the changeset, and then re-apply the changeset and re-compute fields.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;timezone&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">detected_timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Map</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.put(socket.assigns.when_changeset.params, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;timezone&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, detected_timezone)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  changeset </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(socket.assigns.when_changeset, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p><a aria-hidden="true" name="clientinput"></a></p>
<h2>Handling sub-form change events</h2>
<p>Handling form change events doesn’t change with this <code>embedded_schema</code> and
component-ized approach. It’s standard Phoenix and Ecto changeset forms, so it’s
not very interesting to look at. But remember that you’ll need to use
<code>phx-target</code> to send  changes to the LiveComponent, otherwise they may bubble up
to your parent LiveView.</p>
<p>In my case, I also need to adjust the parameters that come in, so we’ll look at
that! I need to check to see what field is changing and apply new parameters
based on what is changing.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;validate&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when_component&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  adjusted_params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> adjust_time_params(params, socket.assigns.when_changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  changeset </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(socket.assigns.when, adjusted_params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">assign_computed</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># I need the start_at for the DatePicker component that I render from this</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># component. I render the timezone and duration on the form. Lastly I</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># compute and render some autocomplete suggestions from the values in the</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># changeset</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:timezone</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_time_autocomplete</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, start_autocompletes(changeset))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_time_autocomplete</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, end_autocompletes(changeset))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">adjust_time_params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  start_at_time </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> params_to_time(params[</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;start_at_time&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  end_at_time </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> params_to_time(params[</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;end_at_time&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">])</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">cond</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    end_at_time </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">!=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_at_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      params_from_new_end_time(start_at_time, end_at_time, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    start_at_time </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">!=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_at_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      duration </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get_field(changeset, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      params_from_new_start_time(start_at_time, duration, params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">true</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      params</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p>Remember, we’re in a LiveComponent so we want to target the changes to itself
and not the parent LiveView. This is accomplished with <code>phx-target</code> on the form.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> f </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form_for </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;#&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_change:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:validate</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_target:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;#</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">#{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">@</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-6">id</span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-6">}</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_submit:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:save</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">id:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@id</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">&lt;%# ... timezone input mentioned above ... %&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> date_select f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:date</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> time_input f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:start_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> time_input f, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:end_time</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  Your duration is </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@duration</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">&lt;/form&gt;</span></span></span></code></pre>
<p><a aria-hidden="true" name="subformsubmission"></a></p>
<h2>Handling the sub-form submission</h2>
<p>When the user tries to submit the form, either by hitting “enter” or clicking on
the submit button, I need to validate the form once again, and if it’s good tell
the parent LiveView that it’s ok to proceed and supply all the
helpfully-computed values.</p>
<p>This time we’ll check if the changeset is valid with
<a href="https://hexdocs.pm/ecto/Ecto.Changeset.html#apply_action/2"><code>Ecto.Changeset.apply_action/2</code></a>. Based on that result, we’ll let the
LiveComponent send a message to <del>itself</del>. Actually, a LiveComponent doesn’t
run in its own process, instead it’s running inside the parent LiveView’s
process. So <code>self()</code> is actually the LiveView and not the LiveComponent. This is
how we can send the parent LiveView the result!</p>
<p>You can <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-liveview-as-the-source-of-truth">read more about LiveComponent and sources of truth in the docs</a>.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveComponent</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;save&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %{</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;when_component&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  socket.assigns.when</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset(params)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.apply_action(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:insert</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">case</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, record} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      send(self(), {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:proceed</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, record})</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, socket}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:error</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:when_changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">        </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_computed(changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># and caught in the parent LiveView:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveView</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_info</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">({</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:proceed</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyAppWeb</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">EventLive</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">WhenComponent</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">form</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">}, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, start_at_wall} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">NaiveDateTime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.new(form.start_at_date, form.start_at_time)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, end_at_wall} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">NaiveDateTime</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.new(form.end_at_date, form.end_at_time)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  params </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> %{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">start_at_utc:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form.start_at,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">start_at_wall:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> start_at_wall,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">start_at_tz:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form.timezone,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">end_at_utc:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form.end_at,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">end_at_wall:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> end_at_wall,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">end_at_tz:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> form.timezone</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:params</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Map</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.merge(socket.assigns.params, params))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign_step(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:next</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<p><a aria-hidden="true" name="formsubmission"></a></p>
<h2>Handling the overall form submission</h2>
<p>You’ll notice that I have a function <code>assign_step</code> above. Let’s go to the parent
LiveView and figure out how to change steps, except on the last step we want to
persist. We’ll look for the steps in the <code>@steps</code> module attribute, assign it,
and that should swap-out the form for the next one!</p>
<p>If there isn’t a next step, then that must mean that we’re finished, so we
should try to save.</p>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="elixir" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyAppWeb.EventLive.Step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">@moduledoc &quot;Describe a step in the multi-step form and where it can go.&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defstruct</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> [</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:name</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:prev</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:next</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defmodule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-4 grvsc-t88nfI-1">MyAppWeb.EventLive.New</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">use</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyAppWeb</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:live_view</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-7">alias</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Ecto</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># ...snip...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">defp</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">assign_step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">step</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">if</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> new_step </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Enum</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.find(</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@steps</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">&amp;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">&amp;1</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.name </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">==</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Map</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.get(socket.assigns.progress, step)) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      assign(socket, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:progress</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, new_step)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">else</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      save(socket)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">save</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># remember we&#39;ve merged all params together, so this should be the complete</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3"># picture.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">case</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Schedule</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.create_event(socket.assigns.params) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:ok</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, event} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_flash(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:info</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, t(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;Event Created&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">          </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> push_redirect(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">to:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Routes</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.live_path(socket, </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">EventLive</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Show</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, event.id))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">      {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:error</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, %</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">{} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> changeset} </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">         socket</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">         </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> assign(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:changeset</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, changeset)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">         </span><span class="grvsc-t5WxC3-6 grvsc-t88nfI-7">|&gt;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> put_flash(</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:error</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;There is an issue with what you filled in&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">@impl</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Phoenix</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">LiveView</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">def</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-5">handle_event</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;prev-step&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3">_content</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1">socket</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">    {</span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:noreply</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, assign_step(socket, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">:prev</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">)}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">  </span><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-14 grvsc-t88nfI-7">end</span></span></span></code></pre>
<pre class="grvsc-container atom-one-light grvsc-mm-t88nfI" data-language="eex" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyAppWeb</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Components</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.secondary_button(t(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;Back&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">), </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_click:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;prev-step&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">&lt;%=</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">MyAppWeb</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.</span><span class="grvsc-t5WxC3-5 grvsc-t88nfI-1">Components</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">.primary_button(t(</span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;Next&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">), </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">phx_disable_with:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-10 grvsc-t88nfI-6">&quot;...&quot;</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">, </span><span class="grvsc-t5WxC3-8 grvsc-t88nfI-4">submit:</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1"> </span><span class="grvsc-t5WxC3-9 grvsc-t88nfI-4">true</span><span class="grvsc-t5WxC3-1 grvsc-t88nfI-1">) </span><span class="grvsc-t5WxC3-15 grvsc-t88nfI-1">%&gt;</span></span></span></code></pre>
<p>Back buttons are easy too. Add <code>phx-click="prev-step"</code> and handle the event in
the same way, except using <code>:prev</code>. Make sure there’s no back button on the
first step! (otherwise you’ll mistakenly try to save).</p>
<h2>Conclusion</h2>
<p>I hope this helps you out in your endeavors to tackle long and complicated
forms. Tweet me <a href="https://twitter.com/bernheisel">@bernheisel</a> if you have suggestions or enjoyed this post!</p>
<h2>Update</h2>
<p>You might want to persist a draft record in-between steps. This is a great idea!
If you do this, then you can leverage LiveView’s <code>handle_params</code> to navigate to
the appropriate step depending on the draft’s progress.</p>
<p>Also, some of my code examples aren’t very good for managing existing resources.
Keep that in mind when developing your own multi-step form. This was written for
the context of <em>creating a new event</em>, and not editing an existing event.
Subscribe to my RSS feed to check for a new post that revisits this problem.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .atom-one-light {
    background-color: #FAFAFA;
    color: #383A42;
  }
  .atom-one-light .grvsc-t5WxC3-i { font-style: italic; }
  .atom-one-light .grvsc-t5WxC3-1 { color: #383A42; }
  .atom-one-light .grvsc-t5WxC3-15 { color: #CA1243; }
  .atom-one-light .grvsc-t5WxC3-6 { color: #986801; }
  .atom-one-light .grvsc-t5WxC3-5 { color: #E45649; }
  .atom-one-light .grvsc-t5WxC3-8 { color: #0184BC; }
  .atom-one-light .grvsc-t5WxC3-14 { color: #A626A4; }
  .atom-one-light .grvsc-t5WxC3-10 { color: #50A14F; }
  .atom-one-light .grvsc-t5WxC3-7 { color: #A0A1A7; }
  .atom-one-light .grvsc-t5WxC3-9 { color: #4078F2; }
  .atom-one-light .grvsc-t5WxC3-4 { color: #C18401; }
  .atom-one-light .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));
  }
  
  /* Monokai Phoenix */
  @media (prefers-color-scheme: dark) {
    .grvsc-mm-t88nfI {
      background-color: #1e1e1e;
      color: #F8F8F2;
    }
    .grvsc-mm-t88nfI .grvsc-t88nfI-i { font-style: italic; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-1 { color: #F8F8F2; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-7 { color: #F92672; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-4 { color: #AE81FF; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-6 { color: #E6DB74; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-3 { color: #75715E; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-5 { color: #A6E22E; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-12 { color: #64D9EA; }
    .grvsc-mm-t88nfI .grvsc-t88nfI-10 { color: #66D9EF; }
    .grvsc-mm-t88nfI .grvsc-line-highlighted::before {
      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
    }
  }
</style></div></article><div class="flex flex-wrap justify-between"><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/elixir-mix-ecto-changeset-podcast/"><svg class="w-6 h-6 mr-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 960v-128q0-26-19-45t-45-19h-502l189-189q19-19 19-45t-19-45l-91-91q-18-18-45-18t-45 18l-362 362-91 91q-18 18-18 45t18 45l91 91 362 362q18 18 45 18t45-18l91-91q18-18 18-45t-18-45l-189-189h502q26 0 45-19t19-45zm256-64q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg><span>Ecto Changesets on Elixir Mix podcast</span></a></div><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/starting-a-new-podcast/"><span>Starting a New Podcast with Thinking |&gt; Elixir</span><svg class="w-6 h-6 ml-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1413 896q0-27-18-45l-91-91-362-362q-18-18-45-18t-45 18l-91 91q-18 18-18 45t18 45l189 189h-502q-26 0-45 19t-19 45v128q0 26 19 45t45 19h502l-189 189q-19 19-19 45t19 45l91 91q18 18 45 18t45-18l362-362 91-91q18-18 18-45zm251 0q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg></a></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/liveview-multi-step-form/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e49f8733b8aee9471acf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-8dc5b1de7df84c955e11.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f9633554493dddb1c536.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f71e923739c6685c4443.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ce130e74c0d10fe8ba37.js"]};/*]]>*/</script><script src="/webpack-runtime-be644e17620554eca688.js" async=""></script><script src="/app-e49f8733b8aee9471acf.js" async=""></script><script src="/framework-1cbcc4f69858806ac5db.js" async=""></script><script src="/1777bc0a756dace6068a54d243c7071eee1627a0-c8bbedbe2105888d6327.js" async=""></script><script src="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js" async=""></script><script src="/styles-48fa8a050a65bb8447bd.js" async=""></script></body></html>