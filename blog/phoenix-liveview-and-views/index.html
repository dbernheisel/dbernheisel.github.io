<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d32f1a90a54f7cd4408c.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@font-face{font-family:Fira Code;src:url(/FiraCode-Light.woff2) format("woff2"),url(/FiraCode-Light.woff) format("woff");font-weight:300;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Regular.woff2) format("woff2"),url(/FiraCode-Regular.woff) format("woff");font-weight:400;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Medium.woff2) format("woff2"),url(/FiraCode-Medium.woff) format("woff");font-weight:500;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-SemiBold.woff2) format("woff2"),url(/FiraCode-SemiBold.woff) format("woff");font-weight:600;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Bold.woff2) format("woff2"),url(/FiraCode-Bold.woff) format("woff");font-weight:700;font-style:normal}@font-face{font-family:Fira Code VF;src:url(/FiraCode-VF.woff2) format("woff2-variations"),url(/FiraCode-VF.woff) format("woff-variations");font-weight:300 700;font-style:normal}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1.125rem;line-height:1.5;letter-spacing:.025em;--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity));background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}code,pre{font-weight:400;letter-spacing:0;font-family:Fira Code!important;border:none!important}.avatar{border-width:2px;--border-opacity:1;border-color:#f7fafc;border-color:rgba(247,250,252,var(--border-opacity));border-radius:9999px;-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.button{padding:.5rem .75rem;font-weight:500;--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));text-decoration:none;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#718096;border-color:rgba(113,128,150,var(--border-opacity));border-radius:.25rem;-webkit-box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity));cursor:default}.button:hover{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.post-container{--border-opacity:1;border-color:#4a5568;border-bottom:2px;border-style:dotted;border-color:rgba(74,85,104,var(--border-opacity))}.link{font-weight:500;--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.link:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.link:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}h1.post-content:before,h1.post-header:before,h2.post-content:before,h2.post-header:before,h3.post-content:before,h3.post-header:before,h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{--text-opacity:1;color:#cbd5e0;color:rgba(203,213,224,var(--text-opacity))}h1.post-content:before,h1.post-header:before{margin-right:1rem;content:"#"}h2.post-content:before,h2.post-header:before{margin-right:.75rem;content:"##"}h3.post-content:before,h3.post-header:before{margin-right:.5rem;content:"###"}h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{margin-right:.25rem;content:"####"}.blog-post h1{font-weight:600;font-size:2.25rem}.blog-post h2{font-weight:600;font-size:1.875rem}.blog-post h3{font-weight:600;font-size:1.5rem}.blog-post h4,.blog-post h5{font-weight:600;font-size:1.25rem}.blog-post h6{font-weight:600;font-size:1.125rem}.post-content blockquote{padding-left:1.5rem;border-left-width:4px;--border-opacity:1;border-color:#9f7aea;border-color:rgba(159,122,234,var(--border-opacity))}.post-content p{margin-top:1rem;margin-bottom:1rem}.post-content ul{list-style-type:disc}.post-content ol,.post-content ul{margin-left:1rem;padding-left:1rem}.post-content ol{list-style-type:decimal}.post-content li{margin-top:.5rem;margin-bottom:.5rem}.post-content strong{font-weight:600}.post-content a{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1)}.post-content a:focus{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity));text-decoration:none}.post-content a.gatsby-resp-image-link:hover{border-width:0}@media (prefers-color-scheme:dark){body{background-color:#1a202c;background-color:rgba(26,32,44,var(--bg-opacity));--text-opacity:1;color:#e2e8f0;color:rgba(226,232,240,var(--text-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity));--bg-opacity:0.25}.avatar{--border-opacity:1;border-color:#2d3748;border-color:rgba(45,55,72,var(--border-opacity))}.button{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:hover{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.post-content a{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:focus{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.link:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity));--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}}.space-x-1>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(0.25rem*var(--space-x-reverse));margin-left:calc(0.25rem*(1 - var(--space-x-reverse)))}.space-y-4>:not(template)~:not(template){--space-y-reverse:0;margin-top:calc(1rem*(1 - var(--space-y-reverse)));margin-bottom:calc(1rem*var(--space-y-reverse))}.space-x-4>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(1rem*var(--space-x-reverse));margin-left:calc(1rem*(1 - var(--space-x-reverse)))}.block{display:block}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.inline-flex{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.hidden{display:none}.flex-col{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.flex-wrap{-ms-flex-wrap:wrap;flex-wrap:wrap}.items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.flex-1{-webkit-box-flex:1;-ms-flex:1 1 0%;flex:1 1 0%}.flex-shrink-0{-ms-flex-negative:0;flex-shrink:0}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-3{height:.75rem}.h-6{height:1.5rem}.h-8{height:2rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-6{line-height:1.5rem}.leading-normal{line-height:1.5}.list-disc{list-style-type:disc}.m-auto{margin:auto}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.ml-0{margin-left:0}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.ml-2{margin-left:.5rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.max-w-3xl{max-width:48rem}.p-2{padding:.5rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.pl-4{padding-left:1rem}.pb-10{padding-bottom:2.5rem}.shadow-md{-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.no-underline{text-decoration:none}.tracking-wider{letter-spacing:.05em}.align-middle{vertical-align:middle}.w-3{width:.75rem}.w-6{width:1.5rem}.w-16{width:4rem}.w-full{width:100%}@media (min-width:768px){.md\:font-extrabold{font-weight:800}.md\:text-4xl{font-size:2.25rem}.md\:ml-4{margin-left:1rem}.md\:w-24{width:6rem}}@media (min-width:1024px){.lg\:inline-block{display:inline-block}.lg\:flex{display:-webkit-box;display:-ms-flexbox;display:flex}.lg\:hidden{display:none}.lg\:items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.lg\:mt-0{margin-top:0}.lg\:w-32{width:8rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.9em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre>code[class*=language-]{font-size:1em}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:1px .2em;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.token.atrule,.token.attr-name,.token.keyword{color:#00a4db}.language-autohotkey .token.tag,.token.deleted,.token.function{color:#9a050f}.language-autohotkey .token.keyword,.token.selector,.token.tag{color:#00009f}.token.bold,.token.function,.token.important{font-weight:700}.token.italic{font-style:italic}</style><meta name="generator" content="Gatsby 2.20.9"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9152758-1', 'auto', {});
      
      
      
      
      
      }</script><link rel="alternate" type="application/rss+xml" title="David Bernheisel&#x27;s Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="36x36" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="48x48" href="/android-chrome-48x48.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="72x72" href="/android-chrome-72x72.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="96x96" href="/android-chrome-96x96.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="144x144" href="/android-chrome-144x144.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png?v=611230f76b9c00b58e5b99e8a179a99d"/><title data-react-helmet="true">Phoenix LiveView and Views | David Bernheisel</title><meta data-react-helmet="true" name="description" content="I’ve written a couple LiveView applications now, Elixir Regex Tester A request logger, much like Phoenix Live Dashboard’s An internal…"/><meta data-react-helmet="true" name="twitter:creator" content="@bernheisel"/><link as="script" rel="preload" href="/styles-48fa8a050a65bb8447bd.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"/><link as="script" rel="preload" href="/1777bc0a756dace6068a54d243c7071eee1627a0-9a08c3058feb24437dbd.js"/><link as="script" rel="preload" href="/framework-1cbcc4f69858806ac5db.js"/><link as="script" rel="preload" href="/app-e49f8733b8aee9471acf.js"/><link as="script" rel="preload" href="/webpack-runtime-2db3d5b7d792be87447e.js"/><link as="fetch" rel="preload" href="/page-data/blog/phoenix-liveview-and-views/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="flex flex-wrap items-center justify-between p-4 shadow-md navbar"><a class="no-underline" href="/"><div class="flex items-center space-x-1"><div class="flex-shrink-0"><img src="/static/profile-picture-977b63cbce04bae4479e3185b22bfb1a.jpg" alt="David Bernheisel" class="w-16 avatar md:w-24 lg:w-32"/></div><div><h3 class="ml-0 text-xl font-bold md:ml-4 md:text-4xl md:font-extrabold leading-6">David Bernheisel</h3></div></div></a><div class="block lg:hidden"><button class="flex items-center px-3 button"><svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div class="w-full block lg:mt-0 mt-4 lg:flex lg:items-center lg:w-auto hidden"><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/">Blog</a><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/projects/">Projects</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://elixir-utilities.herokuapp.com">Utilities</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://twitter.com/bernheisel">Twitter</a><div class="py-1 mt-4 lg:mt-0"><a href="/rss.xml"><img class="h-8 align-middle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgaWQ9IlJTU2ljb24iCiAgICAgdmlld0JveD0iMCAwIDggOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiPgoKICA8dGl0bGU+UlNTIGZlZWQgaWNvbjwvdGl0bGU+CgogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuYnV0dG9uIHtzdHJva2U6IG5vbmU7IGZpbGw6IG9yYW5nZTt9CiAgICAuc3ltYm9sIHtzdHJva2U6IG5vbmU7IGZpbGw6IHdoaXRlO30KICA8L3N0eWxlPgoKICA8cmVjdCAgIGNsYXNzPSJidXR0b24iIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIxLjUiIC8+CiAgPGNpcmNsZSBjbGFzcz0ic3ltYm9sIiBjeD0iMiIgY3k9IjYiIHI9IjEiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsNCBhIDMsMyAwIDAgMSAzLDMgaCAxIGEgNCw0IDAgMCAwIC00LC00IHoiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsMiBhIDUsNSAwIDAgMSA1LDUgaCAxIGEgNiw2IDAgMCAwIC02LC02IHoiIC8+Cgo8L3N2Zz4=" alt="RSS"/></a></div></div></nav><main class="max-w-3xl p-4 m-auto text-lg"><article class="blog-post"><h1 class="post-content text-3xl">Phoenix LiveView and Views</h1><p class="mt-2 mb-4 text-sm frontmatter"><span>Published on <!-- -->June 29, 2020</span><span><span class="mx-2">|</span>13<!-- -->m read</span></p><div class="post-content"><p>I’ve written a couple LiveView applications now,</p>
<ol>
<li><a href="https://elixir-utilities.herokuapp.com">Elixir Regex Tester</a></li>
<li>A request logger, much like <a href="https://github.com/phoenixframework/phoenix_live_dashboard">Phoenix Live Dashboard</a>’s</li>
<li>An internal webmail server, for me to receive and send email through
SendGrid. I hope to open-source this soon when it’s ready.</li>
<li>Another private work-related project.</li>
</ol>
<p>Everytime I build one, I learn something new and find a new pattern, and some
concept finally <em>clicks</em>. Today, that concept that cemented in my mind is how
Phoenix and Phoenix LiveView renders templates.</p>
<p>I want to show you a couple different View-rendering strategies. This should
help you decide which strategy to use.</p>
<p>All of these strategies work, this is purely about opinionated code organizing,
<em>but who doesn’t love reading opinions</em>? Plus we’ll learn how the views are
rendered.</p>
<p>This is written while using Phoenix LiveView 0.13.3.</p>
<h2>TL;DR</h2>
<p>Glossary of examples:</p>
<ol>
<li><code>MyLive</code> = The LiveView module</li>
<li><code>MyView</code> = The standard Phoenix View module, not a LiveView.</li>
<li><code>my_live.html.leex</code> = The template rendered by <code>MyLive</code> or <code>MyView</code></li>
</ol>
<p><strong>If you have a simple LiveView</strong>, then you can implement <code>render(assigns)</code>
and inline your html with the <code>~L</code> sigil. No <code>my_live.html.leex</code> file needed.</p>
<p><strong>If you have a LiveView with lots of HTML</strong>, then you should use the standard
LiveView placement, and put your <code>my_live.ex</code> and <code>my_live.html.leex</code> next to
each other under <code>lib/my_app_web/live</code>. You don’t need to define <code>render/1</code>
because the default will work. Omit it.</p>
<p><strong>If you have a LiveView with lots of HTML helper functions</strong> that you want to
separate from business logic in the LiveView:</p>
<ol>
<li>Add your own standard Phoenix view <code>MyView</code> (or a better name).</li>
<li>Move your <code>my_live.html.leex</code> file to the standard Phoenix locations (ie,
<code>lib/my_app_web/templates/my</code>).</li>
<li>Implement your own <code>render(assigns)</code> that calls
<code>MyAppWeb.MyView.render("my_live.html", assigns)</code>. Phoenix LiveView will
still work; just remember to keep the html file named with an <code>.html.leex</code>
extension so the LiveView rendering engine kicks in.</li>
</ol>
<p><strong>Remember that you can create shared Views</strong>. Alternatively, if your
helpers are used across multiple views and are generic, you can create a plain
module that encapsulates your HTML helpers. I usually call mine <code>ComponentView</code>
and use it inside any of my templates, for example:
<code>Component.primary_button("My Link", to: "yadayada")</code>.</p>
<p><strong>If you want to use a regular View, but co-locate the template to the LiveView module</strong>,
as in you don’t want to go back to the vanilla Phoenix file structure but still
need a separate <code>MyView</code> for your HTML helpers, you can specify the root
folder and path to look in when creating your <code>MyView</code> by supplying an option:
<code>use Phoenix.View, root: "lib/my_app_web/live", path: ""</code>. This is <a href="https://hexdocs.pm/phoenix/Phoenix.View.html#__using__/1-options">explained in the
<code>Phoenix.View</code>
docs</a>. This
can be wrapped up into a convenience macro though. Read on for more info.</p>
<p><strong>This totally ignores LiveComponent</strong> as an option. If your LiveView can be
broken up into interactive components, then breaking out into a LiveComponent is
a good option to look into and works just like a LiveView. For the purpose of
this post and exploring how rendering works, we’re going to treat LiveComponents
the same as a LiveView.</p>
<h2>ToC</h2>
<ul>
<li><a href="#default-phoenix">Phoenix Controller/View/Template</a></li>
<li><a href="#default-liveview">Phoenix LiveView with a template Part 1</a></li>
<li><a href="#pluggy-controllers">Pluggy Controllers</a></li>
<li><a href="#default-liveview">Phoenix LiveView with a template Part 2</a></li>
<li><a href="#liveview-inline">Phoenix LiveView with an inline template</a></li>
<li><a href="#liveview-external">Phoenix LiveView with an external template</a></li>
</ul>
<p><a name="default-phoenix"></a></p>
<h2>Default Phoenix Controller/View/Template</h2>
<p>First, to remember where we came from, I want to show a standard Phoenix
Controller/View/Template pattern. There are several modules involved that the
<code>Plug.Conn</code> travels through in order to turn into a response for the end-user.</p>
<ol>
<li>Incoming request via <code>:cowboy</code></li>
<li>Endpoint</li>
<li>Router</li>
<li>Controller</li>
<li>View</li>
<li>Template (not a module)</li>
<li>Outgoing response via <code>:cowboy</code></li>
</ol>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### Router - lib/my_app_web/router.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>Router <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:router</span>

  <span class="token comment"># ...snip...</span>
  scope <span class="token string">"/"</span><span class="token punctuation">,</span> MyAppWeb <span class="token keyword">do</span>
    pipe_through <span class="token atom symbol">:browser</span>

    get <span class="token string">"/"</span><span class="token punctuation">,</span> PageController<span class="token punctuation">,</span> <span class="token atom symbol">:home</span>
  <span class="token keyword">end</span>
  <span class="token comment"># ...snip...</span>
<span class="token keyword">end</span>


<span class="token comment">### Controller - lib/my_app_web/controllers/page_controller.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>PageController <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:controller</span>  <span class="token comment">#&lt;-- injects some logic to handle receiving</span>
  <span class="token comment"># the conn and passing the conn on to cowboy</span>

  <span class="token keyword">def</span> home<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> _params<span class="token punctuation">)</span> <span class="token keyword">do</span>
    render<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"home.html"</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>


<span class="token comment">### View - lib/my_app_web/views/page_view.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>PageView <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:view</span>  <span class="token comment">#&lt;-- injects some logic to handle evaluating</span>
  <span class="token comment"># the embedded elixir in your templates</span>
<span class="token keyword">end</span></code></pre></div>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- Template - lib/my_app_web/templates/page/home.html.eex
We're going to ignore the layout stuff for now. Just know that it's
also evaluated and this template is a part of it --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Yo! You're rendering the home page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p>In my mind, the template is the end of the show, though that’s not technically
correct; the real <strong>end of the line is the controller</strong>. The controller is using
the view module to evaluate the HTML and puts the result into the Plug.Conn’s
<code>resp_body</code>. The controller terminates the flow and the
once-a-request-and-now-a-response <code>Plug.Conn</code> is returned to the to the
underlying web server, which delivers the payload to the end-user through the
HTTP connection.</p>
<p><a name="default-liveview"></a></p>
<h2>Default Phoenix LiveView without <code>render/1</code></h2>
<p>We’re here to learn about LiveView though, so let’s see an example of a LiveView
without a <code>render/1</code> function.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### lib/my_app_web/live/my_live.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyLive <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:live_view</span>

  <span class="token attribute variable">@impl</span> Phoenix<span class="token punctuation">.</span>LiveView
  <span class="token keyword">def</span> mount<span class="token punctuation">(</span>_params<span class="token punctuation">,</span> _session<span class="token punctuation">,</span> socket<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token comment"># do stuff</span>

    <span class="token punctuation">{</span><span class="token atom symbol">:ok</span><span class="token punctuation">,</span> socket<span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- lib/my_app_web/live/my_live.html.leex --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Yo! I'm rendered by a LiveView<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p>Ok, without a controller, how does a given Phoenix LiveView handle the request?
Here’s a secret: <strong>a LiveView is also an ordinary controller</strong>.</p>
<p>Now… we may not use it like an ordinary Phoenix controller, but the request is
firstly handled like an ordinary web request; one with a Plug.Conn and a full
HTML response back to the user. The LiveView spices are garnished <em>after</em> the
HTML is delivered to the user and a new websocket is initiated to the server to
the page updates to the page.</p>
<p>As said in the LiveView docs:</p>
<blockquote>
<p>A LiveView begins as a regular HTTP request and HTML response,
and then upgrades to a stateful view on client connect,
guaranteeing a regular HTML page even if JavaScript is disabled.
Any time a stateful view changes or updates its socket assigns, it is
automatically re-rendered and the updates are pushed to the client.</p>
</blockquote>
<blockquote>
<p>Prove it!</p>
<p> — you</p>
</blockquote>
<p>ok ok.. I’ll prove it. To prove that it’s a regular controller, we’ll need to
look at some of Phoenix LiveView’s source code. Let’s look at the code that
makes <code>live("/my-route", MyLive)</code> work in the router.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir">defmacro live<span class="token punctuation">(</span>path<span class="token punctuation">,</span> live_view<span class="token punctuation">,</span> action <span class="token operator">\\</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> opts <span class="token operator">\\</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  quote <span class="token attr-name">bind_quoted:</span> binding<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token punctuation">{</span>action<span class="token punctuation">,</span> router_options<span class="token punctuation">}</span> <span class="token operator">=</span>
      Phoenix<span class="token punctuation">.</span>LiveView<span class="token punctuation">.</span>Router<span class="token punctuation">.</span>__live__<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">,</span> live_view<span class="token punctuation">,</span> action<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>

    <span class="token comment"># vvvvv THIS PART</span>
    Phoenix<span class="token punctuation">.</span>Router<span class="token punctuation">.</span>get<span class="token punctuation">(</span>path<span class="token punctuation">,</span> Phoenix<span class="token punctuation">.</span>LiveView<span class="token punctuation">.</span>Plug<span class="token punctuation">,</span> action<span class="token punctuation">,</span> router_options<span class="token punctuation">)</span>
    <span class="token comment"># ^^^^^ THIS PART</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>You see it?! <code>live()</code> is calling this function:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir">Phoenix<span class="token punctuation">.</span>Router<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/my-route"</span><span class="token punctuation">,</span> Phoenix<span class="token punctuation">.</span>LiveView<span class="token punctuation">.</span>Plug<span class="token punctuation">,</span> _action<span class="token punctuation">,</span> _options<span class="token punctuation">)</span></code></pre></div>
<p>You may recognize this as:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir">get <span class="token string">"/my-route"</span><span class="token punctuation">,</span> MyController<span class="token punctuation">,</span> <span class="token atom symbol">:show</span></code></pre></div>
<p>in your own router. We’re going to ignore the action and options for this post,
but the important part is that the <code>live()</code> macro is adding a GET route and
calls the <code>Phoenix.LiveView.Plug</code></p>
<blockquote>
<p>But, that plug isn’t a controller…</p>
<p>— you</p>
</blockquote>
<p>Ah, but it is! A Phoenix Controller, even the ones you make, are indeed all just
plugs underneath. <a href="https://hexdocs.pm/phoenix/plug.html"><strong>All Phoenix controllers are
plugs</strong></a>.</p>
<p><a name="pluggy-controllers"></a></p>
<h2>Pluggy Controllers</h2>
<p>When your controllers call <code>use MyAppWeb, :controller</code>, it’s <em>injecting code</em>
into your controller at compile-time. Let’s explore how that works.</p>
<p>First at step 0 we need to understand that when Elixir code calls <code>use MyUsingModule</code> it’s actually calling <code>MyUsingModule.__using__(opts)</code> at
compile-time, and that resulting code is put into the module that called it.
Knowing that, let’s follow the <code>use</code> trail.</p>
<p>Starting at the top in our own code:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">######################################</span>
<span class="token comment">### Inside MyAppWeb.PageController ###</span>
<span class="token comment">######################################</span>

<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>PageController <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:controller</span>

  <span class="token keyword">def</span> home<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">do</span>
    render<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"home.html"</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">#######################</span>
<span class="token comment">### Inside MyAppWeb ###</span>
<span class="token comment">#######################</span>

defmacro __using__<span class="token punctuation">(</span>which<span class="token punctuation">)</span> <span class="token keyword">when</span> is_atom<span class="token punctuation">(</span>which<span class="token punctuation">)</span> <span class="token keyword">do</span>
  apply<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">,</span> which<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">def</span> controller <span class="token keyword">do</span>
  quote <span class="token keyword">do</span>
    <span class="token comment"># vvv let's look in here vvv</span>
    <span class="token keyword">use</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">,</span> <span class="token attr-name">namespace:</span> MyAppWeb
    <span class="token comment"># ^^^ let's look in here ^^^</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>


<span class="token comment">#################################</span>
<span class="token comment">### Inside Phoenix.Controller ###</span>
<span class="token comment">#################################</span>

defmacro __using__<span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token keyword">do</span>
  quote <span class="token attr-name">bind_quoted:</span> <span class="token punctuation">[</span><span class="token attr-name">opts:</span> opts<span class="token punctuation">]</span> <span class="token keyword">do</span>
    <span class="token keyword">import</span> Phoenix<span class="token punctuation">.</span>Controller

    <span class="token comment"># vvv let's look in here vvv</span>
    <span class="token keyword">use</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>Pipeline<span class="token punctuation">,</span> opts
    <span class="token comment"># ^^^ let's look in here ^^^</span>

    <span class="token keyword">if</span> Keyword<span class="token punctuation">.</span>get<span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token atom symbol">:put_default_views</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
      plug <span class="token atom symbol">:put_new_layout</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>__layout__<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token atom symbol">:app</span><span class="token punctuation">}</span>
      plug <span class="token atom symbol">:put_new_view</span><span class="token punctuation">,</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>__view__<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>


<span class="token comment">##########################################</span>
<span class="token comment">### Inside Phoenix.Controller.Pipeline ###</span>
<span class="token comment">##########################################</span>

defmacro __using__<span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token keyword">do</span>
  quote <span class="token attr-name">bind_quoted:</span> <span class="token punctuation">[</span><span class="token attr-name">opts:</span> opts<span class="token punctuation">]</span> <span class="token keyword">do</span>

    <span class="token attribute variable">@behaviour</span> Plug
    <span class="token comment">## AHA! HERE'S YOUR CONTROLLER PLUG BEHAVIOUR</span>

    <span class="token keyword">require</span> Phoenix<span class="token punctuation">.</span>Endpoint
    <span class="token keyword">import</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>Pipeline

    Module<span class="token punctuation">.</span>register_attribute<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">,</span> <span class="token atom symbol">:plugs</span><span class="token punctuation">,</span> <span class="token attr-name">accumulate:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token attribute variable">@before_compile</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>Pipeline
    <span class="token attribute variable">@phoenix_log_level</span> Keyword<span class="token punctuation">.</span>get<span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token atom symbol">:log</span><span class="token punctuation">,</span> <span class="token atom symbol">:debug</span><span class="token punctuation">)</span>
    <span class="token attribute variable">@phoenix_fallback</span> <span class="token atom symbol">:unregistered</span>

    <span class="token attribute variable">@doc</span> <span class="token boolean">false</span>
    <span class="token keyword">def</span> init<span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> opts

    <span class="token attribute variable">@doc</span> <span class="token boolean">false</span>
    <span class="token keyword">def</span> call<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token keyword">when</span> is_atom<span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token keyword">do</span>
      conn
      <span class="token operator">|></span> merge_private<span class="token punctuation">(</span>
        <span class="token attr-name">phoenix_controller:</span> __MODULE__<span class="token punctuation">,</span>
        <span class="token attr-name">phoenix_action:</span> action
      <span class="token punctuation">)</span>
      <span class="token comment"># fun fact, this function below was introduced</span>
      <span class="token comment"># ~6 years ago in Phoenix 0.5.0 and utilizes unhygienic functions.</span>
      <span class="token comment"># (as in you're in deep macro-land and your normal rules don't apply)</span>
      <span class="token operator">|></span> phoenix_controller_pipeline<span class="token punctuation">(</span>action<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token attribute variable">@doc</span> <span class="token boolean">false</span>
    <span class="token keyword">def</span> action<span class="token punctuation">(</span><span class="token punctuation">%</span>Plug<span class="token punctuation">.</span>Conn<span class="token punctuation">{</span><span class="token attr-name">private:</span> <span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">phoenix_action:</span> action<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> conn<span class="token punctuation">,</span> _options<span class="token punctuation">)</span> <span class="token keyword">do</span>
      apply<span class="token punctuation">(</span>__MODULE__<span class="token punctuation">,</span> action<span class="token punctuation">,</span> <span class="token punctuation">[</span>conn<span class="token punctuation">,</span> conn<span class="token punctuation">.</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    defoverridable <span class="token attr-name">init:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">call:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token attr-name">action:</span> <span class="token number">2</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>Wow! Wild. All this means our slim controllers actually have a lot more code in
it than it appears, and that’s ok because it makes working in Phoenix much more
convenient.</p>
<p><a href="https://hexdocs.pm/plug/Plug.html">All plugs must implement <code>call/2</code> which accepts a conn and returns a
conn</a>. In our case, we’re looking for a conn
that has some rendered HTML.</p>
<p><a name="liveview-default-2"></a></p>
<h2>Back to Default Phoenix LiveView without <code>render/1</code></h2>
<p>Now that we know that LiveViews are a <code>GET</code> request using a standard
controller/plug underneath, let’s look at the <code>Phoenix.LiveView.Plug</code>. We’re
still looking for how a LiveView gets to the template.</p>
<p>LiveView has a similar <code>__using__</code> code-path. Let’s look at LiveView’s plug:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">def</span> call<span class="token punctuation">(</span><span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">private:</span> <span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">phoenix_live_view:</span> <span class="token punctuation">{</span>view<span class="token punctuation">,</span> opts<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> conn<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">do</span>
  opts <span class="token operator">=</span> maybe_dispatch_session<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>

  <span class="token comment"># ...snip... there's a lot of code here we're going to skip</span>
  conn
  <span class="token operator">|></span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span>put_layout<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token operator">|></span> put_root_layout_from_router<span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
  <span class="token comment"># this actually is piped into `Controller.live_render(view, opts)`</span>
  <span class="token comment"># but I'm going to cut/paste what that ends up doing</span>
  <span class="token operator">|></span> LiveView<span class="token punctuation">.</span>Static<span class="token punctuation">.</span>render<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> view<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
  <span class="token comment"># ... more snipping...</span>
  <span class="token operator">|></span> to_rendered_content_tag<span class="token punctuation">(</span>socket<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> view<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span>
  <span class="token comment"># ... more snipping...</span>
  <span class="token operator">|></span> view<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#&lt;-- here here here!</span>
<span class="token keyword">end</span></code></pre></div>
<p>Cool; this isn’t anything new so far. This is just confirming that Phoenix
LiveView starts off as a regular HTTP request with a full HTML response. <em>How
does it render?</em></p>
<p>We see that it’s calling <code>view.render()</code> where <code>view</code> is our own LiveView, but
we didn’t define <code>render/1</code> yet! Where’s it coming from?</p>
<p>When we called <code>use MyAppWeb, :live_view</code> it kicked off a series of <code>__using__</code>,
which includes <code>use Phoenix.LiveView</code>. Inside <code>Phoenix.LiveView</code> it included a
<code>@before_compile Phoenix.LiveView.Renderer</code> hook. Let’s check that out.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir">render? <span class="token operator">=</span> Module<span class="token punctuation">.</span>defines?<span class="token punctuation">(</span>env<span class="token punctuation">.</span>module<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token atom symbol">:render</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
root <span class="token operator">=</span> Path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>env<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
filename <span class="token operator">=</span> template_filename<span class="token punctuation">(</span>env<span class="token punctuation">)</span>
templates <span class="token operator">=</span> Phoenix<span class="token punctuation">.</span>Template<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>root<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>

<span class="token keyword">case</span> <span class="token punctuation">{</span>render?<span class="token punctuation">,</span> templates<span class="token punctuation">}</span> <span class="token keyword">do</span>
  <span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>template<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">-></span>
    ext <span class="token operator">=</span> template <span class="token operator">|></span> Path<span class="token punctuation">.</span>extname<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|></span> String<span class="token punctuation">.</span>trim_leading<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">|></span> String<span class="token punctuation">.</span>to_atom<span class="token punctuation">(</span><span class="token punctuation">)</span>
    engine <span class="token operator">=</span> Map<span class="token punctuation">.</span>fetch!<span class="token punctuation">(</span>Phoenix<span class="token punctuation">.</span>Template<span class="token punctuation">.</span>engines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ext<span class="token punctuation">)</span>
    ast <span class="token operator">=</span> engine<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>template<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>

    quote <span class="token keyword">do</span>
      <span class="token attribute variable">@file</span> unquote<span class="token punctuation">(</span>template<span class="token punctuation">)</span>
      <span class="token attribute variable">@external_resource</span> unquote<span class="token punctuation">(</span>template<span class="token punctuation">)</span>
      <span class="token keyword">def</span> render<span class="token punctuation">(</span>var!<span class="token punctuation">(</span>assigns<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        unquote<span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
  <span class="token comment"># ... other clauses</span>
<span class="token keyword">end</span></code></pre></div>
<p>Finally! This is where the default <code>render/1</code> function comes from. Before our
LiveView compiles, it checks to see if a <code>render/1</code> is defined, and if not, it
will drop one in for us. The default location for LiveView templates is right
next to the LiveView file itself. We see this from the <code>root = Path.dirname(env.file)</code>.</p>
<p><a name="liveview-inline"></a></p>
<h2>Phoenix LiveView with inline <code>render/1</code></h2>
<p>Another option is to implement <code>render/1</code> ourselves. <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html#module-life-cycle">The docs make this pretty
clear how to do that</a>.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### lib/my_app_web/live/my_live.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyLive <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:live_view</span>

  <span class="token attribute variable">@impl</span> Phoenix<span class="token punctuation">.</span>LiveView
  <span class="token keyword">def</span> mount<span class="token punctuation">(</span>_params<span class="token punctuation">,</span> _session<span class="token punctuation">,</span> socket<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token comment"># do stuff</span>

    <span class="token punctuation">{</span><span class="token atom symbol">:ok</span><span class="token punctuation">,</span> socket<span class="token punctuation">}</span>
  <span class="token keyword">end</span>

  <span class="token attribute variable">@impl</span> Phoenix<span class="token punctuation">.</span>LiveView
  <span class="token keyword">def</span> render<span class="token punctuation">(</span>assigns<span class="token punctuation">)</span> <span class="token keyword">do</span>
    ~L<span class="token string">"""
    &lt;p>Yo! I'm rendered from a &lt;%= my_helper("vanilla") %> view&lt;/p>
    """</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> my_helper<span class="token punctuation">(</span><span class="token string">"vanilla"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> <span class="token string">"whoops no this is actually live"</span>
<span class="token keyword">end</span></code></pre></div>
<p>This feels the most similar to frontend frameworks such as Vue with
single-file-components (SFCs), or React.</p>
<p>This is a great option in case your LiveView doesn’t have a lot of HTML. Perhaps
you’re implementing a small widget. At some point, however, it becomes a little
crowded if you have a lot of business logic handling changes in the LiveView as
well as hundreds of lines of HTML and functions to conditionally render some
HTML or apply CSS classes; so you might consider separating the HTML out into
its own file.</p>
<p><a name="liveview-external"></a></p>
<h2>Phoenix LiveView with external <code>render/1</code></h2>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### lib/my_app_web/live/my_live.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyLive <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:live_view</span>

  <span class="token attribute variable">@impl</span> Phoenix<span class="token punctuation">.</span>LiveView
  <span class="token keyword">def</span> mount<span class="token punctuation">(</span>_params<span class="token punctuation">,</span> _session<span class="token punctuation">,</span> socket<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token comment"># do stuff</span>

    <span class="token punctuation">{</span><span class="token atom symbol">:ok</span><span class="token punctuation">,</span> socket<span class="token punctuation">}</span>
  <span class="token keyword">end</span>

  <span class="token attribute variable">@impl</span> Phoenix<span class="token punctuation">.</span>LiveView
  <span class="token keyword">def</span> render<span class="token punctuation">(</span>assigns<span class="token punctuation">)</span> <span class="token keyword">do</span>
    MyAppWeb<span class="token punctuation">.</span>MyView<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"my_live.html"</span><span class="token punctuation">,</span> assigns<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>


<span class="token comment">### lib/my_app_web/views/my_view.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyView <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:view</span>

  <span class="token keyword">def</span> my_helper<span class="token punctuation">(</span><span class="token string">"vanilla"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> <span class="token string">"whoops no this is actually live"</span>
<span class="token keyword">end</span></code></pre></div>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- lib/my_app_web/templates/my/my_live.html.leex --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Yo! I'm rendered from a &lt;%= my_helper("vanilla") %> view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- this renders "whoops no this is actually live" instead of "vanilla" --></span></code></pre></div>
<p>If I have a lot of HTML helpers, then I tend to prefer separating that into a
View module. It’s a little tedious to setup and separate the files, and then
jump between them when developing, but it’s clear where functions should go.</p>
<p>This bugged me though, I have HTML floating in <code>./templates</code> and sometimes in
<code>./live</code> and sometimes inline. Can we consolidate?</p>
<p>Sure we can! <code>Phoenix.View</code> <a href="https://hexdocs.pm/phoenix/Phoenix.View.html?#__using__/1">provides an option to look for templates in a
different folder</a>.
Let’s try it out. We need to supply <code>root</code> and <code>path</code> with <code>use Phoenix.View</code>:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### lib/my_app_web/views/my_view.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyView <span class="token keyword">do</span>
  <span class="token keyword">use</span> Phoenix<span class="token punctuation">.</span>View<span class="token punctuation">,</span>
    <span class="token attr-name">root:</span> <span class="token string">"lib/my_app_web/live"</span><span class="token punctuation">,</span>
    <span class="token attr-name">path:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token attr-name">namespace:</span> MyAppWeb
  <span class="token comment"># and all the other imports that come with `use MyAppWeb, :view`</span>

  <span class="token keyword">def</span> my_helper<span class="token punctuation">(</span><span class="token string">"vanilla"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> <span class="token string">"whoops no this is actually live"</span>
<span class="token keyword">end</span></code></pre></div>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- lib/my_app_web/live/my_live.html.leex --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Yo! I'm rendered from a &lt;%= my_helper("vanilla") %> view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- this renders "whoops no this is actually live" instead of "vanilla" --></span></code></pre></div>
<p>It’s exactly the same, except where the HTML is on disk and that we can’t use
our <code>use MyAppWeb, :view</code> as-is anymore without some further adjustment. To
prove the concept though, copy out all the additional imports you find for views
in <code>my_app_web.ex</code> and place it here for now. If it works out, then you can add
another clause in <code>my_app_web.ex</code> to handle these kinds of views. Maybe
something like this.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token comment">### lib/my_app_web.ex</span>

<span class="token keyword">def</span> view_for_live <span class="token keyword">do</span>
  quote <span class="token keyword">do</span>
    <span class="token keyword">use</span> Phoenix<span class="token punctuation">.</span>View<span class="token punctuation">,</span>
      <span class="token attr-name">root:</span> <span class="token string">"lib/my_app_web/live"</span><span class="token punctuation">,</span>
      <span class="token attr-name">path:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token attr-name">namespace:</span> MyAppWeb

    <span class="token comment"># Import convenience functions from controllers</span>
    <span class="token keyword">import</span> Phoenix<span class="token punctuation">.</span>Controller<span class="token punctuation">,</span> <span class="token attr-name">only:</span> <span class="token punctuation">[</span><span class="token attr-name">get_flash:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">get_flash:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token attr-name">view_module:</span> <span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token comment"># Use all HTML functionality (forms, tags, etc)</span>
    <span class="token keyword">use</span> Phoenix<span class="token punctuation">.</span>HTML

    <span class="token keyword">import</span> MyAppWeb<span class="token punctuation">.</span>ErrorHelpers
    <span class="token keyword">import</span> MyAppWeb<span class="token punctuation">.</span>Gettext
    <span class="token keyword">import</span> Phoenix<span class="token punctuation">.</span>LiveView<span class="token punctuation">.</span>Helpers
    <span class="token keyword">import</span> MyAppWeb<span class="token punctuation">.</span>LiveHelpers
    <span class="token keyword">alias</span> MyAppWeb<span class="token punctuation">.</span>Router<span class="token punctuation">.</span>Helpers<span class="token punctuation">,</span> <span class="token attr-name">as:</span> Routes
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment"># and then use this instead for your LiveView-centric Views</span>
<span class="token comment">### lib/my_app_web/views/my_view.ex</span>
<span class="token keyword">defmodule</span> MyAppWeb<span class="token punctuation">.</span>MyView <span class="token keyword">do</span>
  <span class="token keyword">use</span> MyAppWeb<span class="token punctuation">,</span> <span class="token atom symbol">:view_for_live</span>

  <span class="token keyword">def</span> my_helper<span class="token punctuation">(</span><span class="token string">"vanilla"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> <span class="token string">"whoops no this is actually live"</span>
<span class="token keyword">end</span></code></pre></div>
<h2>What about LiveComponents?</h2>
<p>LiveComponents are totally ignored in this article. They’re another great option
for organizing interactive partials from your LiveViews. Their rendering
strategy is very similar to LiveViews though, and most of this applies to them
as well.</p>
<p>Hope these tips help you out! If you have any more tips, tweet at me
<a href="https://twitter.com/bernheisel">@bernheisel</a></p>
<p>Thank you <a href="https://zachporter.dev/">zporter</a> for helping me with the post by
proof-reading!</p></div></article><div class="flex flex-wrap justify-between"><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/starting-a-new-podcast/"><svg class="w-6 h-6 mr-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 960v-128q0-26-19-45t-45-19h-502l189-189q19-19 19-45t-19-45l-91-91q-18-18-45-18t-45 18l-362 362-91 91q-18 18-18 45t18 45l91 91 362 362q18 18 45 18t45-18l91-91q18-18 18-45t-18-45l-189-189h502q26 0 45-19t19-45zm256-64q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg><span>Starting a New Podcast with Thinking |&gt; Elixir</span></a></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/phoenix-liveview-and-views/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e49f8733b8aee9471acf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-8dc5b1de7df84c955e11.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f933526302f141ff5bf0.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f9633554493dddb1c536.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f71e923739c6685c4443.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ce130e74c0d10fe8ba37.js"]};/*]]>*/</script><script src="/webpack-runtime-2db3d5b7d792be87447e.js" async=""></script><script src="/app-e49f8733b8aee9471acf.js" async=""></script><script src="/framework-1cbcc4f69858806ac5db.js" async=""></script><script src="/1777bc0a756dace6068a54d243c7071eee1627a0-9a08c3058feb24437dbd.js" async=""></script><script src="/component---src-templates-blog-post-js-f933526302f141ff5bf0.js" async=""></script><script src="/styles-48fa8a050a65bb8447bd.js" async=""></script></body></html>