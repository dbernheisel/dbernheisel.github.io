<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.18d390e2bd7878f6815e.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@font-face{font-family:Fira Code;src:url(/FiraCode-Light.woff2) format("woff2"),url(/FiraCode-Light.woff) format("woff");font-weight:300;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Regular.woff2) format("woff2"),url(/FiraCode-Regular.woff) format("woff");font-weight:400;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Medium.woff2) format("woff2"),url(/FiraCode-Medium.woff) format("woff");font-weight:500;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-SemiBold.woff2) format("woff2"),url(/FiraCode-SemiBold.woff) format("woff");font-weight:600;font-style:normal}@font-face{font-family:Fira Code;src:url(/FiraCode-Bold.woff2) format("woff2"),url(/FiraCode-Bold.woff) format("woff");font-weight:700;font-style:normal}@font-face{font-family:Fira Code VF;src:url(/FiraCode-VF.woff2) format("woff2-variations"),url(/FiraCode-VF.woff) format("woff-variations");font-weight:300 700;font-style:normal}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1.125rem;line-height:1.5;letter-spacing:.025em;--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity));background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}code,pre{font-weight:400;letter-spacing:0;font-family:Fira Code!important;border:none!important}.avatar{border-width:2px;--border-opacity:1;border-color:#f7fafc;border-color:rgba(247,250,252,var(--border-opacity));border-radius:9999px;-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.button{padding:.5rem .75rem;font-weight:500;--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));text-decoration:none;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#718096;border-color:rgba(113,128,150,var(--border-opacity));border-radius:.25rem;-webkit-box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity));cursor:default}.button:hover{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));--border-opacity:1;border-color:#4a5568;border-color:rgba(74,85,104,var(--border-opacity))}.post-container{--border-opacity:1;border-color:#4a5568;border-bottom:2px;border-style:dotted;border-color:rgba(74,85,104,var(--border-opacity))}.link{font-weight:500;--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke}.link:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.link:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}h1.post-content:before,h1.post-header:before,h2.post-content:before,h2.post-header:before,h3.post-content:before,h3.post-header:before,h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{--text-opacity:1;color:#cbd5e0;color:rgba(203,213,224,var(--text-opacity))}h1.post-content:before,h1.post-header:before{margin-right:1rem;content:"#"}h2.post-content:before,h2.post-header:before{margin-right:.75rem;content:"##"}h3.post-content:before,h3.post-header:before{margin-right:.5rem;content:"###"}h4.post-content:before,h4.post-header:before,h5.post-content:before,h5.post-header:before,h6.post-content:before,h6.post-header:before{margin-right:.25rem;content:"####"}.blog-post h1{font-weight:600;font-size:2.25rem}.blog-post h2{font-weight:600;font-size:1.875rem}.blog-post h3{font-weight:600;font-size:1.5rem}.blog-post h4,.blog-post h5{font-weight:600;font-size:1.25rem}.blog-post h6{font-weight:600;font-size:1.125rem}.post-content blockquote{padding-left:1.5rem;border-left-width:4px;--border-opacity:1;border-color:#9f7aea;border-color:rgba(159,122,234,var(--border-opacity))}.post-content p{margin-top:1rem;margin-bottom:1rem}.post-content ul{list-style-type:disc}.post-content ol,.post-content ul{margin-left:1rem;padding-left:1rem}.post-content ol{list-style-type:decimal}.post-content li{margin-top:.5rem;margin-bottom:.5rem}.post-content strong{font-weight:600}.post-content a{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));text-decoration:none;-webkit-transition-property:background-color,border-color,color,fill,stroke;transition-property:background-color,border-color,color,fill,stroke;-webkit-transition-duration:.1s;transition-duration:.1s;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1)}.post-content a:focus{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#553c9a;color:rgba(85,60,154,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#9b2c2c;color:rgba(155,44,44,var(--text-opacity));border-bottom-width:1px;--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity));text-decoration:none}.post-content a.gatsby-resp-image-link:hover{border-width:0}@media (prefers-color-scheme:dark){body{background-color:#1a202c;background-color:rgba(26,32,44,var(--bg-opacity));--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.navbar,body{--bg-opacity:1}.navbar{background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity));--bg-opacity:0.25}.avatar{--border-opacity:1;border-color:#2d3748;border-color:rgba(45,55,72,var(--border-opacity))}.button{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity));background-color:#718096;background-color:rgba(113,128,150,var(--bg-opacity));border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.button,.button.disabled{--bg-opacity:1;--border-opacity:1}.button.disabled{background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:hover{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.button:focus{--bg-opacity:1;background-color:#a0aec0;background-color:rgba(160,174,192,var(--bg-opacity));--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.post-content a{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:focus{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.post-content a:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.post-content a:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity))}.link:visited{--text-opacity:1;color:#e9d8fd;color:rgba(233,216,253,var(--text-opacity))}.link:hover{--text-opacity:1;color:#fed7d7;color:rgba(254,215,215,var(--text-opacity));--border-opacity:1;border-color:#38b2ac;border-color:rgba(56,178,172,var(--border-opacity))}}.space-x-1>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(0.25rem*var(--space-x-reverse));margin-left:calc(0.25rem*(1 - var(--space-x-reverse)))}.space-y-4>:not(template)~:not(template){--space-y-reverse:0;margin-top:calc(1rem*(1 - var(--space-y-reverse)));margin-bottom:calc(1rem*var(--space-y-reverse))}.space-x-4>:not(template)~:not(template){--space-x-reverse:0;margin-right:calc(1rem*var(--space-x-reverse));margin-left:calc(1rem*(1 - var(--space-x-reverse)))}.block{display:block}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.inline-flex{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.hidden{display:none}.flex-col{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.flex-wrap{-ms-flex-wrap:wrap;flex-wrap:wrap}.items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.flex-1{-webkit-box-flex:1;-ms-flex:1 1 0%;flex:1 1 0%}.flex-shrink-0{-ms-flex-negative:0;flex-shrink:0}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-3{height:.75rem}.h-6{height:1.5rem}.h-8{height:2rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-6{line-height:1.5rem}.leading-normal{line-height:1.5}.list-disc{list-style-type:disc}.m-auto{margin:auto}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.ml-0{margin-left:0}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.ml-2{margin-left:.5rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.max-w-3xl{max-width:48rem}.p-2{padding:.5rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.pl-4{padding-left:1rem}.pb-10{padding-bottom:2.5rem}.shadow-md{-webkit-box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.no-underline{text-decoration:none}.tracking-wider{letter-spacing:.05em}.align-middle{vertical-align:middle}.w-3{width:.75rem}.w-6{width:1.5rem}.w-16{width:4rem}.w-full{width:100%}@media (min-width:768px){.md\:font-extrabold{font-weight:800}.md\:text-4xl{font-size:2.25rem}.md\:ml-4{margin-left:1rem}.md\:w-24{width:6rem}}@media (min-width:1024px){.lg\:inline-block{display:inline-block}.lg\:flex{display:-webkit-box;display:-ms-flexbox;display:flex}.lg\:hidden{display:none}.lg\:items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.lg\:mt-0{margin-top:0}.lg\:w-32{width:8rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.9em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre>code[class*=language-]{font-size:1em}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:1px .2em;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.token.atrule,.token.attr-name,.token.keyword{color:#00a4db}.language-autohotkey .token.tag,.token.deleted,.token.function{color:#9a050f}.language-autohotkey .token.keyword,.token.selector,.token.tag{color:#00009f}.token.bold,.token.function,.token.important{font-weight:700}.token.italic{font-style:italic}</style><meta name="generator" content="Gatsby 2.20.9"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9152758-1', 'auto', {});
      
      
      
      
      
      }</script><link rel="alternate" type="application/rss+xml" title="David Bernheisel&#x27;s Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="36x36" href="/android-chrome-36x36.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="48x48" href="/android-chrome-48x48.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="72x72" href="/android-chrome-72x72.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="96x96" href="/android-chrome-96x96.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="144x144" href="/android-chrome-144x144.png?v=611230f76b9c00b58e5b99e8a179a99d"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png?v=611230f76b9c00b58e5b99e8a179a99d"/><title data-react-helmet="true">Managing ElixirLS updates in Neovim with asdf and vim-plug | David Bernheisel</title><meta data-react-helmet="true" name="description" content="Kassio’s Post was inspirational, and I adapted from his setup. My setup is a
little different from his: I use asdf to manage my installed…"/><link as="script" rel="preload" href="/styles-48fa8a050a65bb8447bd.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f37877f27548564a00ab.js"/><link as="script" rel="preload" href="/1777bc0a756dace6068a54d243c7071eee1627a0-9a08c3058feb24437dbd.js"/><link as="script" rel="preload" href="/framework-1cbcc4f69858806ac5db.js"/><link as="script" rel="preload" href="/app-e49f8733b8aee9471acf.js"/><link as="script" rel="preload" href="/webpack-runtime-2d45e6a9f2659de65a68.js"/><link as="fetch" rel="preload" href="/page-data/blog/vim-elixir-ls-plug/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="flex flex-wrap items-center justify-between p-4 shadow-md navbar"><a class="no-underline" href="/"><div class="flex items-center space-x-1"><div class="flex-shrink-0"><img src="/static/profile-picture-977b63cbce04bae4479e3185b22bfb1a.jpg" alt="David Bernheisel" class="w-16 avatar md:w-24 lg:w-32"/></div><div><h3 class="ml-0 text-xl font-bold md:ml-4 md:text-4xl md:font-extrabold leading-6">David Bernheisel</h3></div></div></a><div class="block lg:hidden"><button class="flex items-center px-3 button"><svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div class="w-full block lg:mt-0 mt-4 lg:flex lg:items-center lg:w-auto hidden"><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/">Blog</a><a class="no-underline block lg:inline-block mt-4 mr-4 lg:mt-0 button" href="/projects/">Projects</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://elixir-utilities.herokuapp.com">Utilities</a><a class="block mt-4 mr-4 button lg:inline-block lg:mt-0" href="https://twitter.com/bernheisel">Twitter</a><div class="py-1 mt-4 lg:mt-0"><a href="/rss.xml"><img class="h-8 align-middle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgaWQ9IlJTU2ljb24iCiAgICAgdmlld0JveD0iMCAwIDggOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiPgoKICA8dGl0bGU+UlNTIGZlZWQgaWNvbjwvdGl0bGU+CgogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuYnV0dG9uIHtzdHJva2U6IG5vbmU7IGZpbGw6IG9yYW5nZTt9CiAgICAuc3ltYm9sIHtzdHJva2U6IG5vbmU7IGZpbGw6IHdoaXRlO30KICA8L3N0eWxlPgoKICA8cmVjdCAgIGNsYXNzPSJidXR0b24iIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIxLjUiIC8+CiAgPGNpcmNsZSBjbGFzcz0ic3ltYm9sIiBjeD0iMiIgY3k9IjYiIHI9IjEiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsNCBhIDMsMyAwIDAgMSAzLDMgaCAxIGEgNCw0IDAgMCAwIC00LC00IHoiIC8+CiAgPHBhdGggICBjbGFzcz0ic3ltYm9sIiBkPSJtIDEsMiBhIDUsNSAwIDAgMSA1LDUgaCAxIGEgNiw2IDAgMCAwIC02LC02IHoiIC8+Cgo8L3N2Zz4=" alt="RSS"/></a></div></div></nav><main class="max-w-3xl p-4 m-auto text-lg"><article class="blog-post"><h1 class="post-content text-3xl">Managing ElixirLS updates in Neovim with asdf and vim-plug</h1><p class="mt-2 mb-4 text-sm frontmatter"><span>Published on <!-- -->March 03, 2020</span><span><span class="mx-2">|</span>10<!-- -->m read</span></p><div class="post-content"><p><a href="https://kassio.github.io/2019/03/21/elixir-ls-on-coc.nvim.html">Kassio’s Post</a> was inspirational, and I adapted from his setup. My setup is a
little different from his:</p>
<ul>
<li>I use <a href="https://asdf-vm.com">asdf</a> to manage my installed Elixir and Erlang versions. The ElixirLS
project has a tested Elixir version it was developed with; and I’d like to
use that same version. I also don’t want to have to worry about not having
the same installed versions as them.</li>
<li>I use <a href="https://github.com/junegunn/vim-plug">vim-plug</a>. It has a neat feature where you can clone any repository
whether or not it’s built for vim or not. In this case, I’m going to use it
to grab a copy of ElixirLS, and have it run a post-update hook. ElixirLS
doesn’t have any vim code that gets loaded, so it’s benign.</li>
<li>I wanted to let the compilation happen asynchronously. I don’t want
compilation to lock up the UI.</li>
</ul>
<h2>The Proof</h2>
<p>Here’s <a href="https://github.com/elixir-lsp/elixir-ls">ElixirLS</a> in action inside vim with <a href="https://github.com/neoclide/coc.nvim">nvim.coc</a>:</p>
<p><img src="/15e5b60e71e3cb72ffcbbc60de96791e/elixir-ls-in-action.gif" alt="ElixirLS in action"></p>
<p>Here’s me manually calling to update ElixirLS. I have a terminal on the right
that is watching the filesystem so we can see it’s actually doing something:</p>
<p><img src="/2dc5c9710c16b2cc959adb3103a58caa/ManuallyCalling.gif" alt="Elixir Manual Update"></p>
<p>Here’s me using vim-plug to update ElixirLS. I have a terminal on the right
that is watching the filesystem so we can see it’s actually doing something:</p>
<p><img src="/4ffe506c18effd46392cef0a61e55a4b/PlugUpdate.gif" alt="Elixir Manual Update"></p>
<h2>The Vimscript</h2>
<p>Here’s the vim setup:</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">call</span> plug#<span class="token function">begin</span><span class="token punctuation">(</span><span class="token string">'~/.config/nvim/plugged'</span><span class="token punctuation">)</span>
  Plug <span class="token string">'elixir-lsp/elixir-ls'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'do'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token operator">></span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  Plug <span class="token string">'neoclide/coc.nvim'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'branch'</span><span class="token punctuation">:</span> <span class="token string">'release'</span><span class="token punctuation">}</span>
<span class="token keyword">call</span> plug#<span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> g<span class="token punctuation">:</span>coc_global_extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'coc-elixir'</span><span class="token punctuation">,</span> <span class="token string">'coc-diagnostic'</span><span class="token punctuation">]</span>

<span class="token keyword">let</span> g<span class="token punctuation">:</span>ElixirLS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span><span class="token builtin">path</span> <span class="token operator">=</span> <span class="token function">stdpath</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string">'/plugged/elixir-ls'</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span> <span class="token operator">=</span> ElixirLS<span class="token operator">.</span><span class="token builtin">path</span><span class="token operator">.</span><span class="token string">'/release/language_server.sh'</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span>cmd <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        \ <span class="token string">'asdf install &amp;&amp;'</span><span class="token punctuation">,</span>
        \ <span class="token string">'mix do'</span><span class="token punctuation">,</span>
        \ <span class="token string">'local.hex --force --if-missing,'</span><span class="token punctuation">,</span>
        \ <span class="token string">'local.rebar --force,'</span><span class="token punctuation">,</span>
        \ <span class="token string">'deps.get,'</span><span class="token punctuation">,</span>
        \ <span class="token string">'compile,'</span><span class="token punctuation">,</span>
        \ <span class="token string">'elixir_ls.release'</span>
        \ <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_stdout</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> data<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">let</span> self<span class="token operator">.</span>output<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">.=</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">call</span> <span class="token function">extend</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span>on_stderr <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>ElixirLS<span class="token operator">.</span>on_stdout<span class="token punctuation">)</span>

<span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_exit</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> exitcode<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">if</span> a<span class="token punctuation">:</span>exitcode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token keyword">echom</span> <span class="token string">'>>> ElixirLS compiled'</span>
  <span class="token keyword">else</span>
    <span class="token keyword">echoerr</span> <span class="token function">join</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token keyword">echoerr</span> <span class="token string">'>>> ElixirLS compilation failed'</span>
  <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token function">copy</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span>ElixirLS<span class="token punctuation">)</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span>
  <span class="token keyword">echom</span> <span class="token string">'>>> compiling ElixirLS'</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>id <span class="token operator">=</span> <span class="token function">jobstart</span><span class="token punctuation">(</span><span class="token string">'cd '</span> <span class="token operator">.</span> me<span class="token operator">.</span><span class="token builtin">path</span> <span class="token operator">.</span> <span class="token string">' &amp;&amp; git pull &amp;&amp; '</span> <span class="token operator">.</span> me<span class="token operator">.</span>cmd<span class="token punctuation">,</span> me<span class="token punctuation">)</span>
<span class="token keyword">endfunction</span>

<span class="token comment">" If you want to wait on the compilation only when running :PlugUpdate</span>
<span class="token comment">" then have the post-update hook use this function instead:</span>

<span class="token comment">" function ElixirLS.compile_sync()</span>
<span class="token comment">"   echom </span><span class="token string">'>>> compiling ElixirLS'</span>
<span class="token comment">"   silent call system(g:ElixirLS.cmd)</span>
<span class="token comment">"   echom </span><span class="token string">'>>> ElixirLS compiled'</span>
<span class="token comment">" endfunction</span>


<span class="token comment">" Then, update the Elixir language server</span>
<span class="token keyword">call</span> coc#<span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'elixir'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  \ <span class="token string">'command'</span><span class="token punctuation">:</span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span><span class="token punctuation">,</span>
  \ <span class="token string">'filetypes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'elixir'</span><span class="token punctuation">,</span> <span class="token string">'eelixir'</span><span class="token punctuation">]</span>
  \<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">call</span> coc#<span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'elixir.pathToElixirLS'</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span><span class="token punctuation">)</span></code></pre></div>
<p>And this is in my <code class="language-text">:CocConfig</code> (<code class="language-text">~/.config/nvim/coc-settings.json</code>):</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"codeLens.enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"diagnostic-languageserver.filetypes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"elixir"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"mix_credo"</span><span class="token punctuation">,</span> <span class="token string">"mix_credo_compile"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"eelixir"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"mix_credo"</span><span class="token punctuation">,</span> <span class="token string">"mix_credo_compile"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Include coc.nvim, ElixirLS in plug</h2>
<p>Starting from the top:</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">call</span> plug#<span class="token function">begin</span><span class="token punctuation">(</span><span class="token string">'~/.config/nvim/plugged'</span><span class="token punctuation">)</span>
  Plug <span class="token string">'elixir-lsp/elixir-ls'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'do'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token operator">></span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  Plug <span class="token string">'neoclide/coc.nvim'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'branch'</span><span class="token punctuation">:</span> <span class="token string">'release'</span><span class="token punctuation">}</span>
<span class="token keyword">call</span> plug#<span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> g<span class="token punctuation">:</span>coc_global_extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'coc-elixir'</span><span class="token punctuation">,</span> <span class="token string">'coc-diagnostic'</span><span class="token punctuation">]</span></code></pre></div>
<p>I’m using vim-plug to grab some plugins. All we care about for now is coc.nvim
and elixir-ls. I’m providing options for elixir-ls to perform an after-update
action. In this case, a lambda which immediately evaluates <code class="language-text">{ &#39;do&#39;: { -&gt; g:ElixirLS.compile() } }</code></p>
<p>To learn more about the vim lambda, check out <code class="language-text">:h expr-lambda</code>. We’re going to
look at the <code class="language-text">ElixirLS.compile()</code> function later.</p>
<p>The coc.nvim setup is straight from their readme. I’m also adding some
extensions that nvim.coc will install on its own after startup. In this case I
want <a href="https://github.com/amiralies/coc-elixir">coc-elixir</a> and <a href="https://github.com/iamcco/coc-diagnostic">coc-diagnostic</a>.</p>
<p>coc-elixir provides coc.nvim the settings to know how to work with Elixir
projects and the language server. It also will build ElixirLS on its own, but
we’re going to circumvent that in a moment.</p>
<p>coc-diagnostic is a generic bridge for many non-Language-Server tools like
shellcheck and credo. In this case, I’m adding it for credo. I don’t need
coc-diagnostic to provide a formatter, since the main Elixir language server
will provide that already.</p>
<h2>Define your vim ElixirLS dictionary</h2>
<p>Next we’re going to create a dictionary with a couple of functions. This dict is
going to manage several things for us:</p>
<ul>
<li>The path to the language server executable and directory.</li>
<li>The commands to run when needing to compile</li>
<li>Job hook functions so Neovim can run this task asynchronously</li>
</ul>
<p>Check out <code class="language-text">:h dictionary-function</code> in vim for more info on how to be a bit more
object-oriented in your vim scripts. If you go down this rabbit hole, I really
encourage you to look into <code class="language-text">:h lua</code> as well which is better-suited for serious
vim programming.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">let</span> g<span class="token punctuation">:</span>ElixirLS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span><span class="token builtin">path</span> <span class="token operator">=</span> <span class="token function">stdpath</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string">'/plugged/elixir-ls'</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span> <span class="token operator">=</span> ElixirLS<span class="token operator">.</span><span class="token builtin">path</span><span class="token operator">.</span><span class="token string">'/release/language_server.sh'</span>
<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span>cmd <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        \ <span class="token string">'asdf install &amp;&amp;'</span><span class="token punctuation">,</span>
        \ <span class="token string">'mix do'</span><span class="token punctuation">,</span>
        \   <span class="token string">'local.hex --force --if-missing,'</span><span class="token punctuation">,</span>
        \   <span class="token string">'local.rebar --force,'</span><span class="token punctuation">,</span>
        \   <span class="token string">'deps.get,'</span><span class="token punctuation">,</span>
        \   <span class="token string">'compile,'</span><span class="token punctuation">,</span>
        \   <span class="token string">'elixir_ls.release'</span>
        \ <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span></code></pre></div>
<p>So far it’s pretty standard stuff. We initialize an empty global dictionary
first, then start stuffing some values in there. We’re using the function
<code class="language-text">stdpath</code> so we avoid hard-coding any paths.</p>
<p>The <code class="language-text">join([...], &#39; &#39;)</code> is only a way to organize the commands in a visual way.
It’s not necessary; you can totally just concat some strings together. The end
result of this join is:</p>
<div class="gatsby-highlight" data-language="shell-session"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token sh important">$</span> <span class="token bash language-bash">asdf <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> mix <span class="token keyword">do</span> local.hex --force --if-missing, local.rebar --force, deps.get, compile, elixir_ls.release</span></span></code></pre></div>
<p>Since I’m using <a href="https://asdf-vm.com">asdf</a> and <a href="https://github.com/elixir-lsp/elixir-ls/blob/master/.tool-versions">so are the ElixirLS
developers</a>
I want to make sure I’m using the ElixirLS developers’ tools so I know for sure
I won’t run into trouble while developing; I want my ElixirLS to be stable since
it’s such an important tool for me.</p>
<p>We’re going to leverage <a href="https://hexdocs.pm/mix/Mix.Tasks.Do.html">mix do</a> so we’re not starting Elixir fresh for each
command. This should speed some things up.</p>
<h2>Run it in the background</h2>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_stdout</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> data<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">let</span> self<span class="token operator">.</span>output<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">.=</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">call</span> <span class="token function">extend</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">let</span> ElixirLS<span class="token operator">.</span>on_stderr <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>ElixirLS<span class="token operator">.</span>on_stdout<span class="token punctuation">)</span>

<span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_exit</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> exitcode<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">if</span> a<span class="token punctuation">:</span>exitcode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token keyword">echom</span> <span class="token string">'>>> ElixirLS compiled'</span>
  <span class="token keyword">else</span>
    <span class="token keyword">echoerr</span> <span class="token function">join</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token keyword">echoerr</span> <span class="token string">'>>> ElixirLS compilation failed'</span>
  <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token function">copy</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span>ElixirLS<span class="token punctuation">)</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span>
  <span class="token keyword">echom</span> <span class="token string">'>>> compiling ElixirLS'</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>id <span class="token operator">=</span> <span class="token function">jobstart</span><span class="token punctuation">(</span><span class="token string">'cd '</span> <span class="token operator">.</span> me<span class="token operator">.</span><span class="token builtin">path</span> <span class="token operator">.</span> <span class="token string">' &amp;&amp; git pull &amp;&amp; '</span> <span class="token operator">.</span> me<span class="token operator">.</span>cmd<span class="token punctuation">,</span> me<span class="token punctuation">)</span>
<span class="token keyword">endfunction</span></code></pre></div>
<p>These functions are adding keys to the ElixirLS dictionary. If I echo out the
dictionary, you’ll see a normal dictionary with some funcrefs.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token punctuation">:</span>echo ElixirLS
<span class="token punctuation">{</span>
  <span class="token string">'cmd'</span><span class="token punctuation">:</span> <span class="token string">'asdf install &amp;&amp; mix do local.hex --force --if-missing, local.rebar --force, deps.get, compile, elixir_ls.release'</span><span class="token punctuation">,</span>
  <span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">'/home/me/.config/nvim/plugged/elixir-ls'</span><span class="token punctuation">,</span>
  <span class="token string">'on_exit'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'on_stdout'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'lsp'</span><span class="token punctuation">:</span> <span class="token string">'/home/me/.config/nvim/plugged/elixir-ls/release/language_server.sh'</span><span class="token punctuation">,</span>
  <span class="token string">'on_stderr'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">.</span>@<span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'compile'</span><span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>One of the great things about Neovim (and Vim8+) is that it really pushed
asynchronous work forward. Neovim introduced some functions to manage background
jobs. The one we end up using is <code class="language-text">jobstart({cmd}[, {opts}])</code> (check out <code class="language-text">:h jobstart</code>).
<strong>Heads up</strong> this is for Neovim; Vim8 has a different API for asynchronous
work. It’s still <code class="language-text">jobstart</code> but the options are different, so be sure to check
out <code class="language-text">:h job-options</code>.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token function">copy</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span>ElixirLS<span class="token punctuation">)</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span>
  <span class="token keyword">echom</span> <span class="token string">'>>> compiling ElixirLS'</span>
  <span class="token keyword">let</span> me<span class="token operator">.</span>id <span class="token operator">=</span> <span class="token function">jobstart</span><span class="token punctuation">(</span><span class="token string">'cd '</span> <span class="token operator">.</span> me<span class="token operator">.</span><span class="token builtin">path</span> <span class="token operator">.</span> <span class="token string">' &amp;&amp; git pull &amp;&amp; '</span> <span class="token operator">.</span> me<span class="token operator">.</span>cmd<span class="token punctuation">,</span> me<span class="token punctuation">)</span>
<span class="token keyword">endfunction</span></code></pre></div>
<p>First we’re going to make a copy of the dictionary since this can be
asynchronous; we’ll call it <code class="language-text">me</code>. Then we’ll initialize a new key <code class="language-text">output</code> so we
can store all the background job’s output into it. Lastly, we’ll start the job.
The first argument (if a string) will shell out and execute the command you fed
it.</p>
<p>Here’s the complete command that ends up being sent:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">{</span>the-path<span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
  <span class="token function">git</span> pull <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
  asdf <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
  mix <span class="token keyword">do</span> local.hex --force --if-missing, local.rebar --force, deps.get, compile, elixir_ls.release</code></pre></div>
<p><strong>If you’re only using this via vim-plug</strong>, then vim-plug will take care of the
<code class="language-text">cd {the-path} &amp;&amp; git pull</code> on its own, so we don’t need to include that.
Totally skip it and only include <code class="language-text">me.cmd</code>. In my case, I wanted to be able to
run <code class="language-text">:call ElixirLS.compile()</code> myself as well which will need to perform those
tasks. It doesn’t hurt to keep those commands but they’re redundant.</p>
<p>The last argument <code class="language-text">me</code> is a dictionary that contains the keys that point to
functions that will accept a certain signature; the three functions it cares
about are:</p>
<ul>
<li><code class="language-text">on_stdout(job_id, data, event)</code></li>
<li><code class="language-text">on_stderr(job_id, data, event)</code></li>
<li><code class="language-text">on_exit(job_id, exitcode, _event)</code></li>
</ul>
<p>The values that are passed into these functions are a bit odd, but remember it’s
focused on a stream of data, and not all the data at once. This means that the
data you get will be an array of values from the background job’s output (either
stdout or stderr).</p>
<p>Let’s look at one of the functions that receives the hook:</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_stdout</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> data<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">let</span> self<span class="token operator">.</span>output<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">.=</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">call</span> <span class="token function">extend</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> a<span class="token punctuation">:</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">endfunction</span></code></pre></div>
<p><code class="language-text">self</code> refers to the copy of the ElixirLS dictionary that started this job.
(check out <code class="language-text">:h self</code>). Before we started the job, we initialized the dictionary
to have an <code class="language-text">output</code> key that had a list with one empty string <code class="language-text">[&#39;&#39;]</code>. We’re
going to use this list and append all the incoming output into it. At the very
end, <code class="language-text">self.output</code> have something like <code class="language-text">[&#39;hey&#39;, &#39;hi\nthere&#39;, &quot;I&#39;m d&#39;, &#39;one
now&#39;]</code>. Since the data isn’t necessarily split at newlines, we’re going to
combine the last stored output’s with the first incoming element, and then add
the rest of the incoming data to the stored output.</p>
<p><code class="language-text">let self.output[-1] .= a:data[0]</code>. Take the last stored element and concat the
first incoming data’s element, and then assign it back to <code class="language-text">self.output[-1]</code>.
Then add the two lists together. <code class="language-text">extend()</code> will mutate the first element.</p>
<p>Since we want to treat <code class="language-text">stderr</code> and <code class="language-text">stdout</code> as the same kind of output, we’re
going to have the <code class="language-text">on_stderr</code> callback forward the call to the <code class="language-text">on_stdout</code>
function. This avoids duplicating the code.</p>
<p>Finally, let’s look at the <code class="language-text">on_exit</code> callback:</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span> ElixirLS<span class="token operator">.</span><span class="token function">on_exit</span><span class="token punctuation">(</span>_job_id<span class="token punctuation">,</span> exitcode<span class="token punctuation">,</span> _event<span class="token punctuation">)</span>
  <span class="token keyword">if</span> a<span class="token punctuation">:</span>exitcode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token keyword">echom</span> <span class="token string">'>>> ElixirLS compiled'</span>
  <span class="token keyword">else</span>
    <span class="token keyword">echoerr</span> <span class="token function">join</span><span class="token punctuation">(</span>self<span class="token operator">.</span>output<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token keyword">echoerr</span> <span class="token string">'>>> ElixirLS compilation failed'</span>
  <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span></code></pre></div>
<p>The exitcode is passed into this function, but it’s still the funky buffer-like
array but it should always just be the one element with the exit code. If it’s
0, then it exited ok without error so let’s echo a message indicating we’re
done.</p>
<p>Otherwise, let’s echo out the entire output as an error that I can find with
<code class="language-text">:messages</code> and investigate what went wrong.</p>
<p>All this means now is that we can run <code class="language-text">:PlugUpdate</code> and ElixirLS will now update
itself, ensuring it’s running on the best version of Elixir for itself,
everything’s updated, downloaded, and recompiled without issue. I can also run
<code class="language-text">ElixirLS.compile()</code> at any time if I suspect I need to update ElixirLS.</p>
<p>With nvim.coc I can also check <code class="language-text">:CocInfo</code> to see if the language servers are
running ok.</p>
<h2>Use the fruits of the labor</h2>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token keyword">call</span> coc#<span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'elixir'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  \ <span class="token string">'command'</span><span class="token punctuation">:</span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span><span class="token punctuation">,</span>
  \ <span class="token string">'filetypes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'elixir'</span><span class="token punctuation">,</span> <span class="token string">'eelixir'</span><span class="token punctuation">]</span>
  \<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">call</span> coc#<span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'elixir.pathToElixirLS'</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span>ElixirLS<span class="token operator">.</span><span class="token builtin">lsp</span><span class="token punctuation">)</span></code></pre></div>
<p>Almost done!!</p>
<p>We have a somewhat dynamic path for the newly-compiled ElixirLS. On my Mac, the
path could be <code class="language-text">/Users/me/.config/...</code>, but on my Linux computer it would be
<code class="language-text">/home/me/.config/...</code>. CocConfig is a JSON file that can’t evaluate any
environment variables, so I need to resort to calling it from within vim. This
really works out though.</p>
<p>The first <code class="language-text">coc#config</code> is telling coc.nvim in general that there is an available
language server for the <code class="language-text">elixir</code> and <code class="language-text">eexlixir</code> filetypes. Lastly, we’re going
to tell <code class="language-text">coc-elixir</code> to use our own compiled ElixirLS so it doesn’t need to go
off on its own and try to manage the installation and compilation of ElixirLS.</p>
<p>======</p>
<p>Have any vim and Elixir tips of your own? TWEEEEEEEET at me <a href="https://twitter.com/bernheisel">@bernheisel</a></p></div></article><div class="flex flex-wrap justify-between"><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/ecto_changeset_tips/"><svg class="w-6 h-6 mr-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 960v-128q0-26-19-45t-45-19h-502l189-189q19-19 19-45t-19-45l-91-91q-18-18-45-18t-45 18l-362 362-91 91q-18 18-18 45t18 45l91 91 362 362q18 18 45 18t45-18l91-91q18-18 18-45t-18-45l-189-189h502q26 0 45-19t19-45zm256-64q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg><span>Ecto Tips: UUID Boilerplate, Docs, and Composing Changesets</span></a></div><div class="w-full p-2 lg:w-1/2"><a class="no-underline inline-flex items-center flex-1 dark:button-dark button" href="/blog/newtab-notes-chrome-extension/"><span>NewTab Notes Extension</span><svg class="w-6 h-6 ml-2 fill-current" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1413 896q0-27-18-45l-91-91-362-362q-18-18-45-18t-45 18l-91 91q-18 18-18 45t18 45l189 189h-502q-26 0-45 19t-19 45v128q0 26 19 45t45 19h502l-189 189q-19 19-19 45t19 45l91 91q18 18 45 18t45-18l362-362 91-91q18-18 18-45zm251 0q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"></path></svg></a></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/vim-elixir-ls-plug/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e49f8733b8aee9471acf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-8dc5b1de7df84c955e11.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f37877f27548564a00ab.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f9633554493dddb1c536.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f71e923739c6685c4443.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ce130e74c0d10fe8ba37.js"]};/*]]>*/</script><script src="/webpack-runtime-2d45e6a9f2659de65a68.js" async=""></script><script src="/app-e49f8733b8aee9471acf.js" async=""></script><script src="/framework-1cbcc4f69858806ac5db.js" async=""></script><script src="/1777bc0a756dace6068a54d243c7071eee1627a0-9a08c3058feb24437dbd.js" async=""></script><script src="/component---src-templates-blog-post-js-f37877f27548564a00ab.js" async=""></script><script src="/styles-48fa8a050a65bb8447bd.js" async=""></script></body></html>