{"data":{"site":{"siteMetadata":{"title":"David Bernheisel","author":"David Bernheisel"}},"markdownRemark":{"id":"de95679a-bff6-51f7-9cd3-bc06a45f0594","excerpt":"I realized that I love my VIM workflow, so I want to share that with you.\nI am by-no-means a VIM expert or purist ‚Äî my neovim files are not‚Ä¶","timeToRead":8,"html":"<p>I realized that I love my VIM workflow, so I want to share that with you.\nI am by-no-means a VIM expert or purist ‚Äî my [neovim] files are not slim and\nare a melting pot of stolen code from others, sometimes modified or not,\nsometimes found in GitHub comments, sometimes found in others‚Äô dotfiles, or\nReddit comments.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>If you develop in Ruby or Elixir or write Markdown, you might find this helpful!</p>\n<p>Let‚Äôs start with some basics:</p>\n<h2>Environment</h2>\n<ul>\n<li>[neovim] - right now I‚Äôm using 0.4.0 so I can use floating windows.</li>\n<li>[kitty] Terminal Emulator</li>\n<li>built-in terminal in neovim\n&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD</li>\n<li>[ArchLinux] - My distro of choice. Shouldn‚Äôt matter for this article.</li>\n<li>[i3] - My window manager. Shouldn‚Äôt matter for this article.</li>\n<li>[Plug] - for managing neovim plugins.\n||||||| merged common ancestors</li>\n<li>[Plug] for managing neovim plugins.</li>\n<li>\n<h1>[nvim-coc] for languageserver integration.</h1>\n</li>\n<li>[Plug] for managing neovim plugins.</li>\n<li>[nvim-coc] for languageserver integration.</li>\n<li>\n<p><a href=\"https://github.com/dbernheisel/dotfiles\">dotfiles</a> - My dotfiles if you want the complete picture</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</li>\n</ul>\n<p>There are three ways that I can split my workspace: (1) via my window manager\n[i3], (2) via my terminal emulator [kitty], (3) via [neovim] with\nsplits/buffers. Generally I adhere to this practice:</p>\n<ol>\n<li>Split with i3 if it‚Äôs an application, especially a GUI app. This gives me\nthe ability to move the window to another desktop if I want.</li>\n<li>Split with built-in neovim terminal for tests.</li>\n<li>Don‚Äôt split with kitty ever. It‚Äôd be too confusing for me to have 3 sets of\nkeyboard shortcuts to keep track of for switching windows/panes/splits.\nMaybe one day I‚Äôll replace the built-in neovim terminal with a kitty split\nor an i3 split.</li>\n</ol>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD\n[neovim]: <a href=\"https://neovim.io\">https://neovim.io</a>\n[ArchLinux]: <a href=\"https://www.archlinux.org\">https://www.archlinux.org</a>\n[i3]: <a href=\"https://github.com/Airblader/i3\">https://github.com/Airblader/i3</a>\n[kitty]: <a href=\"https://sw.kovidgoyal.net/kitty/\">https://sw.kovidgoyal.net/kitty/</a>\n[Plug]: <a href=\"https://github.com/junegunn/vim-plug\">https://github.com/junegunn/vim-plug</a>\n||||||| merged common ancestors\n[neovim]:\n[ArchLinux]:\n[i3]:\n[kitty]:\n[Plug]:\n[nvim-coc]:\n=======\n[neovim]:\n[ArchLinux]:\n[i3]:\n[kitty]:\n[Plug]:\n[nvim-coc]:\n<a href=\"https://github.com/dbernheisel/dotfiles\">dotfiles</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h2>Testing</h2>\n<p>I use <a href=\"https://github.com/janko/vim-test\">vim-test</a> and it‚Äôs pretty incredible. I picked this workflow up while\nworking at thoughtbot from some good friends and the <a href=\"https://github.com/thoughtbot/dotfiles\">thoughtbot dotfiles</a>,\nand it changed the way I code. The whole TDD workflow is great despite that I\nstill have trouble actually writing tests first - I tend to spike, iterate,\niterate, THEN write tests, then open a PR. Yea‚Äî this probably means I‚Äôm not a\n10x developer üòõ</p>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD\nI use <a href=\"https://github.com/kassio/neoterm\">neoterm</a> to help open up terminal splits while coding. When I‚Äôm at home,\nI have an ultrawide that I use so splitting windows vertically is the way to go;\nbut when I‚Äôm mobile with my laptop then I typically split horizontally. I want\ntests to be visible either way, so I want this to be flexible.\n||||||| merged common ancestors\nI also use neoterm to help open up terminal splits. When I‚Äôm at home, I have an\nultrawide that I use so splitting windows vertically is the way to go; but when\nI‚Äôm mobile with my laptop then I typically split horizontally. I want tests to\nbe visible either way, so I want this to be flexible.\n=======\nI also use neoterm to help open up terminal splits. When I‚Äôm at home, I have an\nultrawide that I use so splitting windows vertically is the way to go; but when\nI‚Äôm mobile with my laptop then I typically split horizontally. I want tests to\nbe visible either way, so I need this to be flexible.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>The vim-test neoterm strategy defaults to sending tests to the last-used neoterm\nbuffer; I can have more terminal buffers, but the first one I open is what\nvim-test will use going forward.</p>\n<p>Here‚Äôs how I configure vim-test with neoterm. (my <a href=\"https://github.com/dbernheisel/dotfiles\">dotfiles</a> for reference)</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\">\n      <pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.config/nvim/init.vim</span>\n\n<span class=\"token comment\">\" Test</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>test#strategy <span class=\"token operator\">=</span> <span class=\"token string\">\"neoterm\"</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_shell <span class=\"token operator\">=</span> <span class=\"token string\">'$SHELL -l'</span> <span class=\"token comment\">\" use the login shell</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_default_mod <span class=\"token operator\">=</span> <span class=\"token string\">'vert'</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_autoscroll <span class=\"token operator\">=</span> <span class=\"token number\">1</span>      <span class=\"token comment\">\" autoscroll to the bottom when entering insert mode</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_size <span class=\"token operator\">=</span> <span class=\"token number\">80</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span> HEAD\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_fixedsize <span class=\"token operator\">=</span> <span class=\"token number\">1</span>       <span class=\"token comment\">\" fixed size. The autosizing was wonky for me</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_keep_term_open <span class=\"token operator\">=</span> <span class=\"token number\">0</span>  <span class=\"token comment\">\" when buffer closes, exit the terminal too.</span>\n<span class=\"token operator\">||</span><span class=\"token operator\">||</span><span class=\"token operator\">||</span>| merged common ancestors\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_fixedsize <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_keep_term_open <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_fixedsize <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_keep_term_open <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">let</span> test#<span class=\"token keyword\">ruby</span>#rspec#<span class=\"token keyword\">options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'suite'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'--profile 5'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span> Edit\n\n<span class=\"token comment\">\" Create some commands that makes the splits easy</span>\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">!</span> <span class=\"token function\">OpenTermV</span><span class=\"token punctuation\">(</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_size <span class=\"token operator\">=</span> <span class=\"token number\">80</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">l</span><span class=\"token punctuation\">:</span>cmd <span class=\"token operator\">=</span> a<span class=\"token punctuation\">:</span><span class=\"token number\">1</span> <span class=\"token operator\">==</span> <span class=\"token string\">''</span> <span class=\"token operator\">?</span> <span class=\"token string\">'pwd'</span> <span class=\"token punctuation\">:</span> a<span class=\"token punctuation\">:</span><span class=\"token number\">1</span>\n  execute <span class=\"token string\">'vert T '</span><span class=\"token operator\">.</span><span class=\"token keyword\">l</span><span class=\"token punctuation\">:</span>cmd\n<span class=\"token keyword\">endfunction</span>\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">!</span> <span class=\"token function\">OpenTermH</span><span class=\"token punctuation\">(</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>neoterm_size <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">l</span><span class=\"token punctuation\">:</span>cmd <span class=\"token operator\">=</span> a<span class=\"token punctuation\">:</span><span class=\"token number\">1</span> <span class=\"token operator\">==</span> <span class=\"token string\">''</span> <span class=\"token operator\">?</span> <span class=\"token string\">'pwd'</span> <span class=\"token punctuation\">:</span> a<span class=\"token punctuation\">:</span><span class=\"token number\">1</span>\n  execute <span class=\"token string\">'belowright T '</span><span class=\"token operator\">.</span><span class=\"token keyword\">l</span><span class=\"token punctuation\">:</span>cmd\n<span class=\"token keyword\">endfunction</span>\n\ncommand<span class=\"token operator\">!</span> <span class=\"token operator\">-</span>nargs<span class=\"token operator\">=</span><span class=\"token operator\">?</span> VT <span class=\"token keyword\">call</span> <span class=\"token function\">OpenTermV</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">q</span><span class=\"token operator\">-</span><span class=\"token keyword\">args</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\ncommand<span class=\"token operator\">!</span> <span class=\"token operator\">-</span>nargs<span class=\"token operator\">=</span><span class=\"token operator\">?</span> HT <span class=\"token keyword\">call</span> <span class=\"token function\">OpenTermH</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">q</span><span class=\"token operator\">-</span><span class=\"token keyword\">args</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">\" Use the project's test suite script if it exists</span>\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">!</span> <span class=\"token function\">RunTestSuite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  Tclear\n  <span class=\"token keyword\">if</span> <span class=\"token function\">filereadable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bin/test_suite'</span><span class=\"token punctuation\">)</span>\n    T echo <span class=\"token string\">'bin/test_suite'</span>\n    T <span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>test_suite\n  <span class=\"token keyword\">elseif</span> <span class=\"token function\">filereadable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bin/test\"</span><span class=\"token punctuation\">)</span>\n    T echo <span class=\"token string\">'bin/test'</span>\n    T <span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>test\n  <span class=\"token keyword\">else</span>\n    TestSuite\n  <span class=\"token keyword\">endif</span>\n<span class=\"token keyword\">endfunction</span>\n\nnmap <span class=\"token operator\">&lt;</span><span class=\"token keyword\">silent</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>leader<span class=\"token operator\">></span><span class=\"token keyword\">t</span> <span class=\"token punctuation\">:</span><span class=\"token keyword\">call</span> TestNearest<span class=\"token operator\">&lt;</span>CR<span class=\"token operator\">></span>\nnmap <span class=\"token operator\">&lt;</span><span class=\"token keyword\">silent</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>leader<span class=\"token operator\">></span>T <span class=\"token punctuation\">:</span><span class=\"token keyword\">call</span> TestFile<span class=\"token operator\">&lt;</span>CR<span class=\"token operator\">></span>\nnmap <span class=\"token operator\">&lt;</span><span class=\"token keyword\">silent</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>leader<span class=\"token operator\">></span>a <span class=\"token punctuation\">:</span><span class=\"token keyword\">call</span> <span class=\"token function\">RunTestSuite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span>CR<span class=\"token operator\">></span>\nnmap <span class=\"token operator\">&lt;</span><span class=\"token keyword\">silent</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>leader<span class=\"token operator\">></span><span class=\"token keyword\">l</span> <span class=\"token punctuation\">:</span><span class=\"token keyword\">call</span> TestLast<span class=\"token operator\">&lt;</span>CR<span class=\"token operator\">></span></code></pre>\n      </div>\n<p>I‚Äôve found it conventional to have a <code class=\"language-text\">bin/test_suite</code> or <code class=\"language-text\">bin/test</code> script in\nthe project that takes care of a lot of details like environment exports,\ncleanup, or making sure the test environment‚Äôs database is setup as well as\nrunning all the tests. Even if the test suite isn‚Äôt complicated, it‚Äôs still\nhelpful for new developers on the project.</p>\n<p>If that script is present and when I want to run all tests, I should execute\nthat file; otherwise use the default vim-test suite command. For non-suite\ntests, I use the default vim-test commands.</p>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD\n<code class=\"language-text\">&lt;space&gt;a</code> triggers the <strong>a</strong>ll tests. If a neoterm split isn‚Äôt open,\nthen it‚Äôll automatically open on with the default settings‚Äî in my case, a\n||||||| merged common ancestors\n<code class=\"language-text\">&lt;space&gt;a</code> triggers the whole suite. ‚ÄúA for All‚Äù. If a neoterm split isn‚Äôt open,\nthen it‚Äôll automatically open on with the default settings‚Äî in my case, a\n=======\n<code class=\"language-text\">&lt;space&gt;a</code> triggers the whole suite. ‚ÄúA for all tests‚Äù. If a neoterm split isn‚Äôt\nopen, then it‚Äôll automatically open on with the default settings‚Äî in my case, a</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit\nvertical split at 80 columns wide. If a neoterm split is already open, then\nit‚Äôll send the test to that split. In situations where my vertical space is\nlacking, I prep by opening up a split, and then hit my test shortcut. <code class=\"language-text\">:HT</code> to\nopen the terminal up.</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD\nIf I‚Äôm testing a method or function, then <code class=\"language-text\">&lt;space&gt;t</code> to send the nearest\n<strong>t</strong>est to it. If I‚Äôm trying to make a test pass, I‚Äôll modify the code and then\n<code class=\"language-text\">&lt;space&gt;l</code> to run the <strong>l</strong>ast test. If I‚Äôm refactoring a class or module, I‚Äôll\nrun all the <strong>T</strong>ests for it. I haven‚Äôt found myself using vim-test‚Äôs TestVisit.\nIf you have some examples on where that command helps, I‚Äôd love to hear it!\n||||||| merged common ancestors\nIn situations where my vertical space is lacking, I prep by opening up a split,\nand then hit my test shortcut. <code class=\"language-text\">:HT</code> to open the terminal up, and then\n<code class=\"language-text\">&lt;space&gt;t</code> to send the nearest test to it.\n=======\nIn any case, I trigger the tests with <code class=\"language-text\">&lt;space&gt;t</code> to send the nearest test, ‚Äút\nfor this test‚Äù; or <code class=\"language-text\">&lt;space&gt;T</code> ‚ÄúT for tests‚Äù; or <code class=\"language-text\">&lt;space&gt;l</code> ‚ÄúLast test‚Äù.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p><a href=\"https://asciinema.org/a/gs6r5QlC8oR8HPNYhRPDypY6n\"><img src=\"https://asciinema.org/a/gs6r5QlC8oR8HPNYhRPDypY6n.svg\" alt=\"asciicast\"></a></p>\n<p>This is a great start! But eventually there might be a pesky app where I need to\nopt-into an environment variable, but only when I‚Äôm running a small number of\ntests. vim-test let‚Äôs me define my own transformations to the commands. I can\ncheck for a certain file and string in it to determine what project I‚Äôm in. If\nI‚Äôm in that project, then change the command where I can.</p>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\">\n      <pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.config/nvim/after/ftplugin/ruby.vim</span>\n<span class=\"token operator\">||</span><span class=\"token operator\">||</span><span class=\"token operator\">||</span>| merged common ancestors\n```viml\n<span class=\"token comment\">\" `/.config/nvim/after/ftplugin/ruby.vim</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>\n```viml\n<span class=\"token comment\">\" ~/.config/nvim/after/ftplugin/ruby.vim</span>\n<span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span> Edit\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">!</span> <span class=\"token function\">MyAppRspec</span><span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">)</span> abort\n  <span class=\"token comment\">\" If I'm in the pesky app and</span>\n  <span class=\"token comment\">\" not running the entire test suite indicated by the --profile flag</span>\n  <span class=\"token comment\">\" Add the SKIP_FIXTURES env var.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">:</span>cmd<span class=\"token punctuation\">,</span> <span class=\"token string\">'--profile'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cat README.md | grep 'MyApp'\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">substitute</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">:</span>cmd<span class=\"token punctuation\">,</span> <span class=\"token string\">'bundle exec'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SKIP_FIXTURES=true bundle exec'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">:</span>cmd\n  <span class=\"token keyword\">endif</span>\n<span class=\"token keyword\">endfunction</span>\n\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>test#custom_transformations <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      \\ <span class=\"token string\">'myapp_ruby'</span><span class=\"token punctuation\">:</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyAppRspec'</span><span class=\"token punctuation\">)</span>\n      \\ <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>test#transformation <span class=\"token operator\">=</span> <span class=\"token string\">'myapp_ruby'</span></code></pre>\n      </div>\n<p>On the Elixir side, umbrella apps can be a little tricky. vim-test will send the\npath of the test to <code class=\"language-text\">mix test {file}</code>, but <code class=\"language-text\">mix</code> will run that command for each\nof the apps in the umbrella. That‚Äôs probably not what we want to do since that\ntest exists for only one for apps. Again, we can solve it with a transformation.</p>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\">\n      <pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.config/nvim/after/ftplugin/elixir.vim</span>\n<span class=\"token operator\">||</span><span class=\"token operator\">||</span><span class=\"token operator\">||</span>| merged common ancestors\n```viml\n<span class=\"token comment\">\" `/.config/nvim/after/ftplugin/elixir.vim</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>\n```viml\n<span class=\"token comment\">\" ~/.config/nvim/after/ftplugin/elixir.vim</span>\n<span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token operator\">></span> Edit\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">!</span> <span class=\"token function\">ElixirUmbrellaTransform</span><span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">)</span> abort\n  <span class=\"token comment\">\" if in an umbrella project indicated by the existence of an ./apps folder</span>\n  <span class=\"token comment\">\" limit the mix command to the app to which the test belongs</span>\n  <span class=\"token keyword\">if</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">:</span>cmd<span class=\"token punctuation\">,</span> <span class=\"token string\">'apps/'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token comment\">\" capture the app from the file path, and send it to the --app flag instead</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">substitute</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">:</span>cmd<span class=\"token punctuation\">,</span> <span class=\"token string\">'mix test apps/\\([^/]*\\)/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mix cmd --app \\1 mix test --color '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">:</span>cmd\n  end\n<span class=\"token keyword\">endfunction</span>\n\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>test#custom_transformations <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n       \\ <span class=\"token string\">'elixir_umbrella'</span><span class=\"token punctuation\">:</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ElixirUmbrellaTransform'</span><span class=\"token punctuation\">)</span>\n       \\ <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>test#transformation <span class=\"token operator\">=</span> <span class=\"token string\">'elixir_umbrella'</span></code></pre>\n      </div>\n<p>That‚Äôs it for tests!</p>\n<p>&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C;&#x3C; HEAD\nHope you picked up something nifty. If you have any tips for me, send them my\nway <a href=\"https://twitter.com/bernheisel\">@bernheisel</a></p>\n<p>||||||| merged common ancestors</p>\n<p>=======</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Edit</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>","frontmatter":{"title":"VIM Testing and Workflow","date":"August 28, 2019","tags":["elixir","ruby","vim"],"originalUrl":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/vim-workflow/","previous":{"fields":{"slug":"/blog/httpoison-decompression/"},"frontmatter":{"title":"HTTPoison and Decompression","tags":["elixir"],"originalUrl":null,"excerpt":"I learned the hard way that the popular HTTP client for Elixir doesn't\nautomatically decompress or re-encode responses. I had to fix it myself.\n"}},"next":null}}