{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/testing-emails-with-bamboo/","result":{"data":{"site":{"siteMetadata":{"title":"David Bernheisel","author":"David Bernheisel"}},"markdownRemark":{"id":"fe6b5407-97ae-5bfb-b84d-190e3650d5b6","excerpt":"Testing a scenario where an app sends an email is easy, but how do you\ntest something random in an email, like a password reset token? When we\ntest a function that intentionally returns random data, it’s a little\ntougher.","timeToRead":2,"html":"<p>Testing a scenario where an app sends an email is easy, but how do you\ntest something random in an email, like a password reset token? When we\ntest a function that intentionally returns random data, it’s a little\ntougher.</p>\n<!-- excerpt -->\n<p>In those times, we often tackle the problem by:</p>\n<ol>\n<li>Testing behavior and static data, ignoring the dynamic data.</li>\n<li>Using a mock to rid the randomized data, and then test everything.</li>\n</ol>\n<p>Let’s walk through how to do this with\n<a href=\"https://github.com/thoughtbot/bamboo\">Bamboo</a>.</p>\n<p>Bamboo provides test helpers to help you assert behavior and data in\nyour app. A really common email scenario is sending users password reset\nlinks. The idea behind these reset links is that they’re <em>secure</em> and\n<em>unique</em>, and we ensure this by generating a random token and signing it\nwith user’s data to make it secure. How do we test this then?</p>\n<p>There are two ways!</p>\n<h2>Use regex to cover the static text and skip dynamic text.</h2>\n<p>Here we are testing the behavior and static data, ignoring the dynamic\ndata.  Bamboo provides <code>assert_email_delivered_with()</code> which accepts a\nkeyword list of parts of the email, and what those parts should match.\nWe can match the email entirely by supplying a string like <code>[subject: \"Password reset link for MyApp\"]</code>, or we can supply a regex, <code>[text: ~r/reset_token=/)</code>, and the assertion will check if the regex matches.</p>\n<p>Here’s a fuller integration test example:</p>\n<pre class=\"grvsc-container atom-one-light grvsc-mm-t88nfI\" data-language=\"elixir\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">test </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;customers can request a password reset link&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, %{</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">session:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> session} </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  customer </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">=</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> insert(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:customer</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  session </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    session</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> visit(password_reset_path(</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MyApp</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">Endpoint</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:new</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> fill_in(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:password_reset</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:email</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">with:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> customer.email)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> click_on(</span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;Send link&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">subject:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;Password reset link for MyApp&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">text_body:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-6\">~r/reset_token=/</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">html_body:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-6\">~r/reset_token=/</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">end</span></span></span></code></pre>\n<h2>Use a mock to rid the random data, and test the whole thing!</h2>\n<p>Here you can guarantee the behavior and (mocked) data, but it’s a little\nmore setup.</p>\n<p>Here’s an example:</p>\n<pre class=\"grvsc-container atom-one-light grvsc-mm-t88nfI\" data-language=\"elixir\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># lib/mock_token_generator.ex</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">defmodule</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-4 grvsc-t88nfI-1\">MyApp.MockTokenGenerator</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">@token</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;123&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># This should match the interface of the real TokenGenerator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">def</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-9 grvsc-t88nfI-5\">generate</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">do:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">@token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># We&#39;re going to expose this in the mock so we can get the assertion</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># right</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">def</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-9 grvsc-t88nfI-5\">token</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">do:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">@token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># config/config.exs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">config </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:my_app</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">token_generator:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MyApp</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">TokenGenerator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># config/test.exs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">config </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:my_app</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">token_generator:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MyApp</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MockTokenGenerator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># web/controllers/password_reset_controller.ex</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">defmodule</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-4 grvsc-t88nfI-1\">MyApp.PasswordResetController</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">@generator</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">Application</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.get_env(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:my_app</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:token_generator</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">def</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-9 grvsc-t88nfI-5\">create</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">(</span><span class=\"grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1\">conn</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-6 grvsc-t5WxC3-i grvsc-t88nfI-1\">params</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">) </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\">#...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># use the @generator.generate function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># do your email thing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\">#...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># test/features/password_reset_test.exs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-7 grvsc-t5WxC3-i grvsc-t88nfI-3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-9 grvsc-t88nfI-7\">alias</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MyApp</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MockTokenGenerator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">test </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;customers can request a password reset link&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, %{</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">session:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> session} </span><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  customer </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">=</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> insert(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:customer</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  session </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    session</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> visit(password_reset_path(</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">MyApp</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">.</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-1\">Endpoint</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:new</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> fill_in(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:password_reset</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">:email</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">, </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">with:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> customer.email)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">    </span><span class=\"grvsc-t5WxC3-6 grvsc-t88nfI-7\">|&gt;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> click_on(</span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;Send link&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">subject:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;Password reset link for MyApp&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">text_body:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">    Here&#39;s the entire body of the text email. You might test the entire</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">    text version of the email, and use regex to test the HTML version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">    Here&#39;s your password reset link: https://myapp.com/password?reset_token=</span><span class=\"grvsc-t5WxC3-15 grvsc-t88nfI-6\">#{</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-6\">MockTokenGenerator</span><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">.token</span><span class=\"grvsc-t5WxC3-15 grvsc-t88nfI-6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-10 grvsc-t88nfI-6\">  &quot;&quot;&quot;</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">  assert_email_delivered_with(</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-4\">html_body:</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\"> </span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-6\">~r|https://myapp.com/password?reset_token=</span><span class=\"grvsc-t5WxC3-15 grvsc-t88nfI-6\">#{</span><span class=\"grvsc-t5WxC3-5 grvsc-t88nfI-6\">MockTokenGenerator</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-6\">.token</span><span class=\"grvsc-t5WxC3-15 grvsc-t88nfI-6\">}</span><span class=\"grvsc-t5WxC3-8 grvsc-t88nfI-6\">|</span><span class=\"grvsc-t5WxC3-1 grvsc-t88nfI-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t5WxC3-14 grvsc-t88nfI-7\">end</span></span></span></code></pre>\n<p>See? <a href=\"https://github.com/thoughtbot/bamboo\">Bamboo</a> makes it easy. Give\nit a shot and let us know what you think.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .atom-one-light {\n    background-color: #FAFAFA;\n    color: #383A42;\n  }\n  .atom-one-light .grvsc-t5WxC3-i { font-style: italic; }\n  .atom-one-light .grvsc-t5WxC3-1 { color: #383A42; }\n  .atom-one-light .grvsc-t5WxC3-10 { color: #50A14F; }\n  .atom-one-light .grvsc-t5WxC3-8 { color: #0184BC; }\n  .atom-one-light .grvsc-t5WxC3-14 { color: #A626A4; }\n  .atom-one-light .grvsc-t5WxC3-6 { color: #986801; }\n  .atom-one-light .grvsc-t5WxC3-5 { color: #E45649; }\n  .atom-one-light .grvsc-t5WxC3-7 { color: #A0A1A7; }\n  .atom-one-light .grvsc-t5WxC3-4 { color: #C18401; }\n  .atom-one-light .grvsc-t5WxC3-9 { color: #4078F2; }\n  .atom-one-light .grvsc-t5WxC3-15 { color: #CA1243; }\n  .atom-one-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  \n  /* Monokai Phoenix */\n  @media (prefers-color-scheme: dark) {\n    .grvsc-mm-t88nfI {\n      background-color: #1e1e1e;\n      color: #F8F8F2;\n    }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-1 { color: #F8F8F2; }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-6 { color: #E6DB74; }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-4 { color: #AE81FF; }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-7 { color: #F92672; }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-3 { color: #75715E; }\n    .grvsc-mm-t88nfI .grvsc-t88nfI-5 { color: #A6E22E; }\n    .grvsc-mm-t88nfI .grvsc-line-highlighted::before {\n      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n    }\n  }\n</style>","frontmatter":{"title":"Testing Random Data in Emails with Bamboo","date":"October 16, 2017","tags":["elixir"],"originalUrl":"https://robots.thoughtbot.com/testing-emails-with-bamboo"}}},"pageContext":{"slug":"/blog/testing-emails-with-bamboo/","previous":{"fields":{"slug":"/blog/lessons-from-using-phoenix-1-3/"},"frontmatter":{"title":"Lessons From Using Phoenix 1.3","tags":["elixir"],"originalUrl":"https://robots.thoughtbot.com/lessons-from-using-phoenix-1-3","excerpt":null}},"next":{"fields":{"slug":"/blog/querying-embedded-maps-in-postgresql-with-ecto/"},"frontmatter":{"title":"Querying an Embedded Map in PostgreSQL with Ecto","tags":["elixir"],"originalUrl":"https://robots.thoughtbot.com/querying-embedded-maps-in-postgresql-with-ecto","excerpt":null}}}}}